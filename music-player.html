<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dusk Music Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(180deg, #E8F4F8 0%, #D1E7F0 50%, #B8D9E8 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 200px;
            color: #1a1a1a;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(74, 144, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(91, 155, 213, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(74, 144, 226, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .auth-section {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(74, 144, 226, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a1a;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #4A90E2;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }

        input::placeholder {
            color: rgba(44, 62, 80, 0.5);
        }

        button {
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #4A90E2;
            border: 2px solid #4A90E2;
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: #4A90E2;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .status.success {
            background: rgba(46, 204, 113, 0.15);
            color: #27ae60;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .status.error {
            background: rgba(231, 76, 60, 0.15);
            color: #c0392b;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.2);
            padding-bottom: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.6);
            border: none;
            border-radius: 12px 12px 0 0;
            color: #4A90E2;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #4A90E2;
            font-weight: 600;
            border-bottom-color: #4A90E2;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }

        /* –°–µ—Ç–∫–∏ –¥–ª—è –∞—Ä—Ç–∏—Å—Ç–æ–≤, –∞–ª—å–±–æ–º–æ–≤, —Ç—Ä–µ–∫–æ–≤ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.2);
            background: #fff;
        }

        .card-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 10px;
            object-fit: cover;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .card-subtitle {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ */
        .tracks-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .track-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 18px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.08);
        }

        .track-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.15);
            background: #fff;
        }

        .track-cover {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .track-info {
            flex: 1;
            min-width: 0;
        }

        .track-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .track-artist {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .track-duration {
            color: #95a5a6;
            font-size: 0.85em;
            white-space: nowrap;
        }

        /* –ü–ª–µ–µ—Ä */
        .player-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-top: 2px solid rgba(74, 144, 226, 0.2);
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .player-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .player-cover {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .player-info {
            flex: 1;
            min-width: 0;
        }

        .now-playing {
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .now-playing-artist {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .player-audio {
            flex: 2;
            min-width: 300px;
        }

        audio {
            width: 100%;
            outline: none;
        }

        .hidden {
            display: none !important;
        }
        

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .breadcrumb {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            color: #4A90E2;
            cursor: pointer;
            font-weight: 500;
        }

        .breadcrumb-item:hover {
            color: #2c3e50;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #95a5a6;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-container {
            margin-bottom: 30px;
            position: relative;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 14px 24px;
            border: 2px solid rgba(74, 144, 226, 0.2);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a1a;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }

        .search-input::placeholder {
            color: rgba(44, 62, 80, 0.5);
        }

        .search-input:focus {
            background: #fff;
            border-color: #4A90E2;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }

        .search-button {
            padding: 12px 30px;
            border-radius: 25px;
            white-space: nowrap;
        }

        .search-results {
            margin-top: 20px;
        }

        .search-results-group {
            margin-bottom: 30px;
        }

        .search-results-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.2);
            color: #2c3e50;
        }

        .search-result-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.08);
        }

        .search-result-item:hover {
            transform: translateX(5px);
            background: #fff;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.15);
        }

        .search-result-cover {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .search-result-subtitle {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .search-result-type {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            background: rgba(74, 144, 226, 0.1);
            color: #4A90E2;
            white-space: nowrap;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal:not(.hidden) {
            animation: fadeIn 0.2s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.8);
            position: relative;
            color: #1a1a1a;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(74, 144, 226, 0.1);
            border: none;
            color: #4A90E2;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
            margin: 0;
        }

        .modal-close:hover {
            background: #4A90E2;
            color: white;
            transform: rotate(90deg);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.8em;
        }

        .playlist-select-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid transparent;
        }

        .playlist-select-item:hover {
            background: rgba(74, 144, 226, 0.1);
            border-color: rgba(74, 144, 226, 0.3);
        }

        .playlist-select-item.selected {
            background: rgba(74, 144, 226, 0.15);
            border: 2px solid #4A90E2;
        }

        .playlist-select-item input[type="radio"] {
            margin-right: 10px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ç—Ä–µ–∫–æ–≤ */
        .track-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .action-button {
            background: transparent;
            border: 1px solid rgba(74, 144, 226, 0.2);
            color: #4A90E2;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            font-weight: 400;
            min-width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-button:hover {
            background: rgba(74, 144, 226, 0.08);
            border-color: rgba(74, 144, 226, 0.4);
            color: #4A90E2;
        }

        .action-button.favorite {
            background: transparent;
            border-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .action-button.favorite:hover {
            background: rgba(220, 53, 69, 0.08);
            border-color: rgba(220, 53, 69, 0.4);
            color: #dc3545;
        }

        .playlist-item {
            position: relative;
        }

        .playlist-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .playlist-action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #666;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 300;
            transition: all 0.15s ease;
            backdrop-filter: blur(10px);
        }

        .playlist-action-btn:hover {
            background: rgba(220, 53, 69, 0.1);
            border-color: rgba(220, 53, 69, 0.3);
            color: #dc3545;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—Ä—Ç–∏—Å—Ç–∞ */
        .artist-profile-section {
            margin-bottom: 40px;
        }

        .artist-profile-header {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.1);
        }

        .artist-profile-photo {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(74, 144, 226, 0.2);
            flex-shrink: 0;
        }

        .artist-profile-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .artist-profile-name {
            font-size: 3em;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .artist-profile-followers {
            font-size: 1.1em;
            color: #7f8c8d;
            font-weight: 500;
        }

        .artist-follow-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            align-self: flex-start;
        }

        .artist-follow-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
        }

        .artist-follow-btn.following {
            background: rgba(74, 144, 226, 0.1);
            color: #4A90E2;
            border: 2px solid #4A90E2;
        }

        .artist-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.1);
            margin-bottom: 30px;
        }

        .artist-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #7f8c8d;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: capitalize;
        }

        .artist-tab:hover {
            color: #4A90E2;
        }

        .artist-tab.active {
            color: #4A90E2;
            border-bottom-color: #4A90E2;
        }

        .artist-content-section {
            min-height: 300px;
        }

        .artist-tracks-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .artist-track-row {
            display: grid;
            grid-template-columns: 40px 60px 1fr auto auto 50px;
            gap: 15px;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .artist-track-row:hover {
            background: rgba(74, 144, 226, 0.05);
        }

        .artist-track-row.playing {
            background: rgba(74, 144, 226, 0.1);
        }

        .artist-track-number {
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: center;
            font-weight: 500;
        }

        .artist-track-play-icon {
            color: #4A90E2;
            font-size: 1.2em;
            text-align: center;
            cursor: pointer;
        }

        .artist-track-cover {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
        }

        .artist-track-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .artist-track-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1em;
        }

        .artist-track-playcount {
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: right;
        }

        .artist-track-duration {
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dusk Music Player</h1>

        <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
        <div class="auth-section" id="authSection">
            <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <div class="input-group">
                <label>Username –∏–ª–∏ Email:</label>
                <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ username –∏–ª–∏ email" value="">
            </div>
            <div class="input-group">
                <label>Password:</label>
                <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ password" value="">
            </div>
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <div id="authStatus"></div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="hidden" id="mainContent">
            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤, –∞—Ä—Ç–∏—Å—Ç–æ–≤, –∞–ª—å–±–æ–º–æ–≤..." onkeypress="handleSearchKeyPress(event)">
                    <button class="search-button" onclick="performSearch()">üîç –ü–æ–∏—Å–∫</button>
                </div>
                <div id="searchResults" class="search-results hidden"></div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('artists')">–ê—Ä—Ç–∏—Å—Ç—ã</button>
                <button class="nav-tab" onclick="showTab('albums')">–ê–ª—å–±–æ–º—ã</button>
                <button class="nav-tab" onclick="showTab('tracks')">–¢—Ä–µ–∫–∏</button>
                <button class="nav-tab" onclick="showTab('playlists')">–ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
            </div>

            <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
            <div class="breadcrumb hidden" id="breadcrumb">
                <span class="breadcrumb-item" onclick="goHome()">–ì–ª–∞–≤–Ω–∞—è</span>
            </div>

            <!-- –ê—Ä—Ç–∏—Å—Ç—ã -->
            <div id="artistsTab" class="tab-content">
                <div class="section-header">
                    <h2>–ê—Ä—Ç–∏—Å—Ç—ã</h2>
                    <button onclick="loadArtists()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div id="artistsList" class="grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤...</div>
                </div>
            </div>

            <!-- –ê–ª—å–±–æ–º—ã -->
            <div id="albumsTab" class="tab-content hidden">
                <div class="section-header">
                    <h2 id="albumsTitle">–ê–ª—å–±–æ–º—ã</h2>
                    <button onclick="loadAlbums()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div id="albumsList" class="grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>
                </div>
            </div>

            <!-- –¢—Ä–µ–∫–∏ -->
            <div id="tracksTab" class="tab-content hidden">
                <div class="section-header">
                    <h2 id="tracksTitle">–¢—Ä–µ–∫–∏</h2>
                    <button onclick="loadTracks()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div id="tracksList" class="tracks-list">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>
                </div>
            </div>

            <!-- –ü–ª–µ–π–ª–∏—Å—Ç—ã -->
            <div id="playlistsTab" class="tab-content hidden">
                <div class="section-header">
                    <h2>–ú–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã</h2>
                    <div>
                        <button onclick="showCreatePlaylistModal()" class="btn-secondary">+ –°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</button>
                        <button onclick="loadPlaylists()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>
                <div id="playlistsList" class="grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—Ä—Ç–∏—Å—Ç–∞ -->
            <div id="artistPageTab" class="tab-content hidden">
                <div class="artist-profile-section">
                    <div class="artist-profile-header">
                        <img id="artistProfilePhoto" class="artist-profile-photo" src="" alt="Artist" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="artist-profile-info">
                            <h1 id="artistProfileName" class="artist-profile-name"></h1>
                            <div id="artistProfileFollowers" class="artist-profile-followers"></div>
                            <button id="artistFollowBtn" class="artist-follow-btn" onclick="toggleFollowArtist()">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                        </div>
                    </div>
                    <div class="artist-tabs">
                        <button class="artist-tab active" onclick="showArtistTab('tracks')" id="artistTabTracks">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏</button>
                        <button class="artist-tab" onclick="showArtistTab('albums')" id="artistTabAlbums">–ê–ª—å–±–æ–º—ã</button>
                        <button class="artist-tab" onclick="showArtistTab('playlists')" id="artistTabPlaylists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
                    </div>
                </div>
                <div id="artistContentArea">
                    <div id="artistTracksContent" class="artist-content-section">
                        <div id="artistTracksList" class="artist-tracks-list">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>
                        </div>
                    </div>
                    <div id="artistAlbumsContent" class="artist-content-section hidden">
                        <div id="artistAlbumsList" class="grid">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>
                        </div>
                    </div>
                    <div id="artistPlaylistsContent" class="artist-content-section hidden">
                        <div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç—ã –∞—Ä—Ç–∏—Å—Ç–∞ –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
    <div id="createPlaylistModal" class="modal hidden" onclick="if(event.target === this) closeCreatePlaylistModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeCreatePlaylistModal()" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
            <h2>–°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</h2>
            <div class="input-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞:</label>
                <input type="text" id="playlistNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" maxlength="50">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="createPlaylist()" style="flex: 1;">–°–æ–∑–¥–∞—Ç—å</button>
                <button onclick="closeCreatePlaylistModal()" class="btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ –≤ –ø–ª–µ–π–ª–∏—Å—Ç -->
    <div id="addToPlaylistModal" class="modal hidden" onclick="if(event.target === this) closeAddToPlaylistModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeAddToPlaylistModal()" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
            <h2>–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç</h2>
            <div id="playlistsSelectList" style="max-height: 300px; overflow-y: auto; margin: 20px 0;">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="addToPlaylistBtn" onclick="addTrackToSelectedPlaylist()" style="flex: 1;" disabled>–î–æ–±–∞–≤–∏—Ç—å</button>
                <button onclick="closeAddToPlaylistModal()" class="btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ü–ª–µ–µ—Ä -->
    <div class="player-section hidden" id="playerSection">
        <div class="player-content">
            <img id="playerCover" class="player-cover" src="" alt="Cover">
            <div class="player-info">
                <div class="now-playing" id="nowPlaying">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</div>
                <div class="now-playing-artist" id="nowPlayingArtist"></div>
            </div>
            <div class="player-audio">
                <audio id="audioPlayer" controls>
                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
                </audio>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        let token = localStorage.getItem('token') || '';
        let currentTrack = null;
        let currentView = { type: 'artists', artistId: null, albumId: null };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            // –í–°–ï–ì–î–ê –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å–∞–π—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const addModal = document.getElementById('addToPlaylistModal');
            const createModal = document.getElementById('createPlaylistModal');
            if (addModal) {
                addModal.classList.add('hidden');
            }
            if (createModal) {
                createModal.classList.add('hidden');
            }
            
            // –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ localStorage
            token = '';
            localStorage.removeItem('token');
            
            // –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –∏ —Å–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
            const authSection = document.getElementById('authSection');
            const mainContent = document.getElementById('mainContent');
            
            if (authSection) {
                authSection.classList.remove('hidden');
            }
            if (mainContent) {
                mainContent.classList.add('hidden');
            }
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤—Ö–æ–¥–∞
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const authStatus = document.getElementById('authStatus');
            
            if (usernameInput) usernameInput.value = '';
            if (passwordInput) passwordInput.value = '';
            if (authStatus) authStatus.innerHTML = '';
        };

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const statusDiv = document.getElementById('authStatus');

            if (!username || !password) {
                statusDiv.innerHTML = '<div class="status error">–í–≤–µ–¥–∏—Ç–µ username/email –∏ password</div>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        usernameOrEmail: username,
                        password: password 
                    })
                });

                if (!response.ok) {
                    let errorMessage = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.error || '–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    statusDiv.innerHTML = `<div class="status error">${errorMessage}</div>`;
                    return;
                }

                const data = await response.json();

                if (data.accessToken) {
                    token = data.accessToken;
                    localStorage.setItem('token', token);
                    statusDiv.innerHTML = '<div class="status success">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</div>';
                    
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    showTab('artists');
                } else {
                    statusDiv.innerHTML = '<div class="status error">–¢–æ–∫–µ–Ω –Ω–µ –ø–æ–ª—É—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8080</div>`;
                console.error('Login error:', error);
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('searchInput').value = '';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // –ï—Å–ª–∏ –≤—ã–∑–≤–∞–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
                const buttons = document.querySelectorAll('.nav-tab');
                if (tabName === 'artists') buttons[0].classList.add('active');
                else if (tabName === 'albums') buttons[1].classList.add('active');
                else if (tabName === 'tracks') buttons[2].classList.add('active');
                else if (tabName === 'playlists') buttons[3].classList.add('active');
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            currentView = { type: tabName, artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            if (tabName === 'artists') {
                loadArtists();
            } else if (tabName === 'albums') {
                loadAlbums();
            } else if (tabName === 'tracks') {
                loadTracks();
            } else if (tabName === 'playlists') {
                loadPlaylists();
            }
        }

        function goHome() {
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞—Ä—Ç–∏—Å—Ç–∞
            document.getElementById('artistPageTab').classList.add('hidden');
            currentArtistId = null;
            currentArtistData = null;
            currentView = { type: 'artists', artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            showTab('artists');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤
        async function loadArtists() {
            const artistsListDiv = document.getElementById('artistsList');
            artistsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/artists?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const artists = data.content || [];

                if (artists.length === 0) {
                    artistsListDiv.innerHTML = '<div class="loading">–ê—Ä—Ç–∏—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                artistsListDiv.innerHTML = artists.map(artist => `
                    <div class="card" onclick="viewArtist(${artist.id})">
                        <img class="card-image" src="${getImageUrl(artist.photoUrl)}" alt="${escapeHtml(artist.name || '–ê—Ä—Ç–∏—Å—Ç')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="card-title">${escapeHtml(artist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                    </div>
                `).join('');
            } catch (error) {
                artistsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∞—Ä—Ç–∏—Å—Ç–∞ (–∞–ª—å–±–æ–º—ã –∞—Ä—Ç–∏—Å—Ç–∞)
        let currentArtistId = null;
        let currentArtistData = null;

        async function viewArtist(artistId) {
            currentArtistId = artistId;
            currentView = { type: 'artist', artistId: artistId, albumId: null };
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏
            document.getElementById('breadcrumb').classList.add('hidden');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞—Ä—Ç–∏—Å—Ç–∞
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById('artistPageTab').classList.remove('hidden');
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç–∞
            try {
                const response = await fetch(`${API_BASE}/artists/${artistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const artist = await response.json();
                currentArtistData = artist;

                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –∞—Ä—Ç–∏—Å—Ç–∞
                document.getElementById('artistProfileName').textContent = artist.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç';
                document.getElementById('artistProfilePhoto').src = artist.photoUrl ? getImageUrl(artist.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E';
                document.getElementById('artistProfileFollowers').textContent = `${artist.followers || 0} —Å–ª—É—à–∞—Ç–µ–ª–µ–π`;
                
                const followBtn = document.getElementById('artistFollowBtn');
                if (artist.followed) {
                    followBtn.textContent = '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è';
                    followBtn.classList.add('following');
                } else {
                    followBtn.textContent = '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                    followBtn.classList.remove('following');
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                showArtistTab('tracks');
            } catch (error) {
                console.error('Error loading artist:', error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ç–∏—Å—Ç–∞: ${error.message}`);
            }
        }

        async function showArtistTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.artist-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`artistTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('.artist-content-section').forEach(section => section.classList.add('hidden'));
            
            if (tabName === 'tracks') {
                document.getElementById('artistTracksContent').classList.remove('hidden');
                await loadArtistTracks();
            } else if (tabName === 'albums') {
                document.getElementById('artistAlbumsContent').classList.remove('hidden');
                await loadArtistAlbums();
            } else if (tabName === 'playlists') {
                document.getElementById('artistPlaylistsContent').classList.remove('hidden');
            }
        }

        async function loadArtistTracks() {
            if (!currentArtistId) return;
            
            const tracksListDiv = document.getElementById('artistTracksList');
            tracksListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/artists/${currentArtistId}/tracks?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                tracksListDiv.innerHTML = tracks.map((track, index) => {
                    const coverUrl = getTrackCoverUrl(track);
                    const isPlaying = currentTrack && currentTrack.id === track.id;
                    return `
                        <div class="artist-track-row ${isPlaying ? 'playing' : ''}" onclick="playTrack(${track.id})">
                            <div class="artist-track-number">${index + 1}</div>
                            <img class="artist-track-cover" src="${coverUrl}" alt="Cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                            <div class="artist-track-info">
                                <div class="artist-track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            </div>
                            <div class="artist-track-playcount">${track.playCount || 0}</div>
                            <div class="artist-track-duration">${formatDuration(track.duration || 0)}</div>
                            <button class="action-button favorite" onclick="event.stopPropagation(); toggleFavorite(${track.id})" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ô°</button>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                tracksListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        async function loadArtistAlbums() {
            if (!currentArtistId) return;
            
            const albumsListDiv = document.getElementById('artistAlbumsList');
            albumsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/albums/artist/${currentArtistId}?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const data = await response.json();
                const albums = data.content || [];

                if (albums.length === 0) {
                    albumsListDiv.innerHTML = '<div class="loading">–ê–ª—å–±–æ–º–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                albumsListDiv.innerHTML = albums.map(album => `
                    <div class="card" onclick="viewAlbum(${album.id})">
                        <img class="card-image" src="${album.photoUrl ? getImageUrl(album.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'}" alt="${escapeHtml(album.title || '–ê–ª—å–±–æ–º')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="card-title">${escapeHtml(album.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        <div class="card-subtitle">${escapeHtml(album.artist?.name || '')}</div>
                    </div>
                `).join('');
            } catch (error) {
                albumsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        async function toggleFollowArtist() {
            if (!currentArtistId) return;
            
            try {
                const response = await fetch(`${API_BASE}/artists/${currentArtistId}/follow`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                if (currentArtistData) {
                    currentArtistData.followed = !currentArtistData.followed;
                    const followBtn = document.getElementById('artistFollowBtn');
                    if (currentArtistData.followed) {
                        followBtn.textContent = '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è';
                        followBtn.classList.add('following');
                        currentArtistData.followers = (currentArtistData.followers || 0) + 1;
                    } else {
                        followBtn.textContent = '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                        followBtn.classList.remove('following');
                        currentArtistData.followers = Math.max(0, (currentArtistData.followers || 0) - 1);
                    }
                    document.getElementById('artistProfileFollowers').textContent = `${currentArtistData.followers || 0} —Å–ª—É—à–∞—Ç–µ–ª–µ–π`;
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                console.error('Toggle follow error:', error);
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–ª—å–±–æ–º–∞ (—Ç—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞)
        async function viewAlbum(albumId) {
            currentView = { type: 'tracks', artistId: null, albumId: albumId };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.getElementById('breadcrumb').innerHTML = `
                <span class="breadcrumb-item" onclick="goHome()">–ì–ª–∞–≤–Ω–∞—è</span>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item" onclick="showTab('albums')">–ê–ª—å–±–æ–º—ã</span>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item">–¢—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞</span>
            `;
            document.getElementById('breadcrumb').classList.remove('hidden');
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–∫–æ–≤
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById('tracksTab').classList.remove('hidden');
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.nav-tab')[2].classList.add('active');
            
            const tracksListDiv = document.getElementById('tracksList');
            tracksListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/albums/${albumId}/tracks?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                tracksListDiv.innerHTML = tracks.map(track => {
                    const coverUrl = getTrackCoverUrl(track);
                    return `
                    <div class="track-item" onclick="playTrack(${track.id})">
                        <img class="track-cover" src="${coverUrl}" alt="Cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                        <div class="track-info">
                            <div class="track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="track-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                        </div>
                        <div class="track-duration">${formatDuration(track.duration || 0)}</div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                tracksListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∞–ª—å–±–æ–º–æ–≤
        async function loadAlbums() {
            currentView = { type: 'albums', artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            const albumsListDiv = document.getElementById('albumsList');
            albumsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/albums?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const albums = data.content || [];

                if (albums.length === 0) {
                    albumsListDiv.innerHTML = '<div class="loading">–ê–ª—å–±–æ–º–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                albumsListDiv.innerHTML = albums.map(album => `
                    <div class="card" onclick="viewAlbum(${album.id})">
                        <img class="card-image" src="${getImageUrl(album.photoUrl)}" alt="${escapeHtml(album.title || '–ê–ª—å–±–æ–º')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="card-title">${escapeHtml(album.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        <div class="card-subtitle">${escapeHtml(album.artist?.name || '')}</div>
                    </div>
                `).join('');
            } catch (error) {
                albumsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤
        async function loadTracks() {
            currentView = { type: 'tracks', artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            const tracksListDiv = document.getElementById('tracksList');
            tracksListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/tracks?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                tracksListDiv.innerHTML = tracks.map(track => {
                    const coverUrl = getTrackCoverUrl(track);
                    return `
                    <div class="track-item">
                        <img class="track-cover" src="${coverUrl}" alt="Cover" onclick="playTrack(${track.id})" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'" style="cursor: pointer;">
                        <div class="track-info" onclick="playTrack(${track.id})" style="cursor: pointer; flex: 1;">
                            <div class="track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="track-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                        </div>
                        <div class="track-actions">
                            <button class="action-button favorite" onclick="event.stopPropagation(); toggleFavorite(${track.id})" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ô°</button>
                            <button class="action-button" onclick="event.stopPropagation(); showAddToPlaylistModal(${track.id})" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç">+</button>
                            <div class="track-duration">${formatDuration(track.duration || 0)}</div>
                        </div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                tracksListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
        async function playTrack(trackId) {
            try {
                const response = await fetch(`${API_BASE}/tracks/${trackId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`–¢—Ä–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω: ${response.status}`);
                }

                const track = await response.json();
                currentTrack = track;

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∞—É–¥–∏–æ
                let audioUrl = track.audioUrl;
                if (!audioUrl) {
                    throw new Error('audioUrl –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–∞');
                }

                if (!audioUrl.startsWith('http')) {
                    if (audioUrl.startsWith('audio/') || audioUrl.startsWith('covers/')) {
                        audioUrl = `http://localhost:8080/api/v1/files/${audioUrl}`;
                    } else if (audioUrl.startsWith('/')) {
                        audioUrl = `http://localhost:8080${audioUrl}`;
                    } else {
                        audioUrl = `http://localhost:8080/api/v1/files/audio/${audioUrl}`;
                    }
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = audioUrl;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø–ª–µ–µ—Ä–µ
                document.getElementById('nowPlaying').textContent = track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                document.getElementById('nowPlayingArtist').textContent = track.artist?.name || track.artistName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç';
                const playerCoverUrl = getTrackCoverUrl(track, 200);
                document.getElementById('playerCover').src = playerCoverUrl;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–µ—Ä
                document.getElementById('playerSection').classList.remove('hidden');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –∞—Ä—Ç–∏—Å—Ç–∞, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—Ä—Ç–∏—Å—Ç–∞
                if (currentArtistId && document.getElementById('artistPageTab') && !document.getElementById('artistPageTab').classList.contains('hidden')) {
                    loadArtistTracks();
                }

                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error('Play error:', error);
                    });
                }

                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
                incrementPlayCount(trackId);

            } catch (error) {
                console.error('Play track error:', error);
                alert(`–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ${error.message}`);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function getImageUrl(path) {
            if (!path) {
                return '';
            }
            if (path.startsWith('http://') || path.startsWith('https://')) {
                return path;
            }
            if (path.startsWith('covers/') || path.startsWith('audio/')) {
                return `http://localhost:8080/api/v1/files/${path}`;
            }
            if (path.startsWith('/')) {
                return `http://localhost:8080${path}`;
            }
            return `http://localhost:8080/api/v1/files/covers/${path}`;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–ª–æ–∂–∫–∏ —Ç—Ä–µ–∫–∞ - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±–ª–æ–∂–∫—É –∞–ª—å–±–æ–º–∞
        function getTrackCoverUrl(track, placeholderSize = 60) {
            // –¢—Ä–µ–∫ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–ª–æ–∂–∫—É –∞–ª—å–±–æ–º–∞
            if (track.album && track.album.photoUrl) {
                return getImageUrl(track.album.photoUrl);
            }
            // –ï—Å–ª–∏ –∞–ª—å–±–æ–º–∞ –Ω–µ—Ç –∏–ª–∏ —É –∞–ª—å–±–æ–º–∞ –Ω–µ—Ç –æ–±–ª–æ–∂–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º placeholder
            return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${placeholderSize}' height='${placeholderSize}'%3E%3Crect fill='%23e0e0e0' width='${placeholderSize}' height='${placeholderSize}'/%3E%3C/svg%3E`;
        }

        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
        async function incrementPlayCount(trackId) {
            try {
                await fetch(`${API_BASE}/tracks/${trackId}/play`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function handleAuthError() {
            token = '';
            localStorage.removeItem('token');
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            alert('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ü–æ–∏—Å–∫
        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            const searchResultsDiv = document.getElementById('searchResults');

            if (!query) {
                searchResultsDiv.classList.add('hidden');
                return;
            }

            searchResultsDiv.innerHTML = '<div class="loading">–ü–æ–∏—Å–∫...</div>';
            searchResultsDiv.classList.remove('hidden');

            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            try {
                const response = await fetch(`${API_BASE}/search?query=${encodeURIComponent(query)}&size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                const results = data.content || [];

                if (results.length === 0) {
                    searchResultsDiv.innerHTML = '<div class="loading">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–∏–ø—É
                const tracks = results.filter(r => r.type === 'track');
                const artists = results.filter(r => r.type === 'artist');
                const albums = results.filter(r => r.type === 'album');

                let html = '';

                // –¢—Ä–µ–∫–∏
                if (tracks.length > 0) {
                    html += '<div class="search-results-group">';
                    html += '<div class="search-results-title">–¢—Ä–µ–∫–∏ (' + tracks.length + ')</div>';
                    html += tracks.map(track => {
                        const coverUrl = track.coverUrl ? getImageUrl(track.coverUrl) : `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='50' height='50'%3E%3Crect fill='%23e0e0e0' width='50' height='50'/%3E%3C/svg%3E`;
                        return `
                        <div class="search-result-item" onclick="playTrack(${track.id})">
                            <img class="search-result-cover" src="${coverUrl}" alt="Cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'">
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(track.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="search-result-subtitle">${escapeHtml(track.subtitle || '')}</div>
                            </div>
                            <div class="search-result-type">–¢—Ä–µ–∫</div>
                        </div>
                    `;
                    }).join('');
                    html += '</div>';
                }

                // –ê—Ä—Ç–∏—Å—Ç—ã
                if (artists.length > 0) {
                    html += '<div class="search-results-group">';
                    html += '<div class="search-results-title">–ê—Ä—Ç–∏—Å—Ç—ã (' + artists.length + ')</div>';
                    html += artists.map(artist => `
                        <div class="search-result-item" onclick="viewArtist(${artist.id})">
                            <img class="search-result-cover" src="${artist.coverUrl ? getImageUrl(artist.coverUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'}" alt="Artist" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'">
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(artist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="search-result-subtitle">${escapeHtml(artist.subtitle || '')}</div>
                            </div>
                            <div class="search-result-type">–ê—Ä—Ç–∏—Å—Ç</div>
                        </div>
                    `).join('');
                    html += '</div>';
                }

                // –ê–ª—å–±–æ–º—ã
                if (albums.length > 0) {
                    html += '<div class="search-results-group">';
                    html += '<div class="search-results-title">–ê–ª—å–±–æ–º—ã (' + albums.length + ')</div>';
                    html += albums.map(album => `
                        <div class="search-result-item" onclick="viewAlbum(${album.id})">
                            <img class="search-result-cover" src="${album.coverUrl ? getImageUrl(album.coverUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'}" alt="Album" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'">
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(album.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="search-result-subtitle">${escapeHtml(album.subtitle || '')}</div>
                            </div>
                            <div class="search-result-type">–ê–ª—å–±–æ–º</div>
                        </div>
                    `).join('');
                    html += '</div>';
                }

                searchResultsDiv.innerHTML = html;

            } catch (error) {
                searchResultsDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}</div>`;
                console.error('Search error:', error);
            }
        }

        // ========== –ü–õ–ï–ô–õ–ò–°–¢–´ ==========

        let selectedTrackId = null;
        let favoritePlaylistId = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
        async function loadPlaylists() {
            const playlistsListDiv = document.getElementById('playlistsList');
            playlistsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/playlists/my-playlists`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const playlists = await response.json();

                // –ù–∞—Ö–æ–¥–∏–º –∏–∑–±—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                const favorite = playlists.find(p => p.isFavorite);
                if (favorite) {
                    favoritePlaylistId = favorite.id;
                }

                if (playlists.length === 0) {
                    playlistsListDiv.innerHTML = '<div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç!</div>';
                    return;
                }

                playlistsListDiv.innerHTML = playlists.map(playlist => `
                    <div class="card playlist-item" onclick="viewPlaylist(${playlist.id})">
                        <div class="playlist-actions">
                            ${!playlist.isFavorite ? `<button class="playlist-action-btn" onclick="event.stopPropagation(); deletePlaylist(${playlist.id})" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>` : ''}
                        </div>
                        <div class="card-image" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 3em;">
                            ${playlist.isFavorite ? '‚ô°' : ''}
                        </div>
                        <div class="card-title">${escapeHtml(playlist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        <div class="card-subtitle">${playlist.track ? playlist.track.length : 0} —Ç—Ä–µ–∫–æ–≤</div>
                    </div>
                `).join('');
            } catch (error) {
                playlistsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
                console.error('Load playlists error:', error);
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–µ–π–ª–∏—Å—Ç–∞
        async function viewPlaylist(playlistId) {
            try {
                const response = await fetch(`${API_BASE}/playlists/${playlistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–ü–ª–µ–π–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: ${response.status}`);
                }

                const playlist = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                document.getElementById('breadcrumb').innerHTML = `
                    <span class="breadcrumb-item" onclick="goHome()">–ì–ª–∞–≤–Ω–∞—è</span>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item" onclick="showTab('playlists')">–ü–ª–µ–π–ª–∏—Å—Ç—ã</span>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item">${escapeHtml(playlist.name)}</span>
                `;
                document.getElementById('breadcrumb').classList.remove('hidden');

                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–∫–æ–≤
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
                document.getElementById('tracksTab').classList.remove('hidden');
                document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.nav-tab')[2].classList.add('active');

                const tracksListDiv = document.getElementById('tracksList');
                const tracks = playlist.track || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç –ø—É—Å—Ç</div>';
                    return;
                }

                tracksListDiv.innerHTML = tracks.map(item => {
                    const track = item.track;
                    const coverUrl = getTrackCoverUrl(track);
                    return `
                        <div class="track-item">
                            <img class="track-cover" src="${coverUrl}" alt="Cover" onclick="playTrack(${track.id})" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'" style="cursor: pointer;">
                            <div class="track-info" onclick="playTrack(${track.id})" style="cursor: pointer; flex: 1;">
                                <div class="track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="track-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                            </div>
                            <div class="track-actions">
                                ${playlist.isFavorite ? `<button class="action-button" onclick="event.stopPropagation(); removeFromFavorite(${track.id})" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">√ó</button>` : ''}
                                ${!playlist.isFavorite ? `<button class="action-button" onclick="event.stopPropagation(); removeTrackFromPlaylist(${playlistId}, ${track.id})" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞">√ó</button>` : ''}
                                <div class="track-duration">${formatDuration(track.duration || 0)}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('View playlist error:', error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${error.message}`);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
        function showCreatePlaylistModal() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (!token) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
                return;
            }
            
            const modal = document.getElementById('createPlaylistModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
                modal.style.visibility = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
                modal.style.opacity = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            }
            const input = document.getElementById('playlistNameInput');
            if (input) {
                input.value = '';
                input.focus(); // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            }
        }

        function closeCreatePlaylistModal() {
            const modal = document.getElementById('createPlaylistModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            const input = document.getElementById('playlistNameInput');
            if (input) input.value = '';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (!document.getElementById('createPlaylistModal').classList.contains('hidden')) {
                    closeCreatePlaylistModal();
                }
                if (!document.getElementById('addToPlaylistModal').classList.contains('hidden')) {
                    closeAddToPlaylistModal();
                }
            }
        });

        async function createPlaylist() {
            const name = document.getElementById('playlistNameInput').value.trim();

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlists`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: name })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${response.status}`);
                }

                closeCreatePlaylistModal();
                loadPlaylists();
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${error.message}`);
                console.error('Create playlist error:', error);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
        async function deletePlaylist(playlistId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–µ–π–ª–∏—Å—Ç?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlists/${playlistId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                }

                loadPlaylists();
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${error.message}`);
                console.error('Delete playlist error:', error);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        async function toggleFavorite(trackId) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                if (!favoritePlaylistId) {
                    const response = await fetch(`${API_BASE}/playlists/my-favorite`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const favorite = await response.json();
                        favoritePlaylistId = favorite.id;
                    } else {
                        alert('–ò–∑–±—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç—Ä–µ–∫ —É–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º
                const playlistResponse = await fetch(`${API_BASE}/playlists/${favoritePlaylistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (playlistResponse.ok) {
                    const playlist = await playlistResponse.json();
                    const trackExists = playlist.track && playlist.track.some(item => item.track.id === trackId);

                    if (trackExists) {
                        // –£–¥–∞–ª—è–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                        await removeFromFavorite(trackId);
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        await addTrackToPlaylist(favoritePlaylistId, trackId);
                        alert('–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
                    }
                }
            } catch (error) {
                console.error('Toggle favorite error:', error);
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        async function removeFromFavorite(trackId) {
            try {
                const response = await fetch(`${API_BASE}/playlists/tracks`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playlistId: favoritePlaylistId,
                        trackId: trackId
                    })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                }

                alert('–¢—Ä–µ–∫ —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –≤–∏–¥, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –ø–ª–µ–π–ª–∏—Å—Ç
                if (currentView.type === 'playlists') {
                    loadPlaylists();
                }
            } catch (error) {
                console.error('Remove from favorite error:', error);
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ø–ª–µ–π–ª–∏—Å—Ç
        async function showAddToPlaylistModal(trackId) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (!token) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
                return;
            }
            
            if (!trackId) {
                console.error('showAddToPlaylistModal called without trackId');
                return;
            }
            
            selectedTrackId = trackId;
            const modal = document.getElementById('addToPlaylistModal');
            const addBtn = document.getElementById('addToPlaylistBtn');
            
            if (!modal) {
                console.error('Modal element not found');
                return;
            }
            
            modal.classList.remove('hidden');
            modal.style.display = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            modal.style.visibility = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            modal.style.opacity = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            if (addBtn) addBtn.disabled = true;
            
            const playlistsSelectList = document.getElementById('playlistsSelectList');
            playlistsSelectList.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/playlists/my-playlists`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    closeAddToPlaylistModal();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const playlists = await response.json();

                if (playlists.length === 0) {
                    playlistsSelectList.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #7f8c8d;">
                            <p style="margin-bottom: 15px;">–ù–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç —Å–Ω–∞—á–∞–ª–∞.</p>
                            <button onclick="closeAddToPlaylistModal(); setTimeout(() => showCreatePlaylistModal(), 300);" style="background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%); color: white; padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600;">
                                –°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç
                            </button>
                        </div>
                    `;
                    if (addBtn) addBtn.disabled = true;
                    return;
                }

                playlistsSelectList.innerHTML = playlists.map(playlist => `
                    <div class="playlist-select-item" onclick="selectPlaylist(${playlist.id})">
                        <div>
                            <strong>${escapeHtml(playlist.name)}</strong>
                            <div style="font-size: 0.9em; color: #7f8c8d;">
                                ${playlist.isFavorite ? '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ' : `${playlist.track ? playlist.track.length : 0} —Ç—Ä–µ–∫–æ–≤`}
                            </div>
                        </div>
                        <input type="radio" name="playlistSelect" value="${playlist.id}" id="playlist_${playlist.id}">
                    </div>
                `).join('');
                
                if (addBtn) addBtn.disabled = false;

            } catch (error) {
                playlistsSelectList.innerHTML = `
                    <div class="status error" style="text-align: center; padding: 20px;">
                        <p>–û—à–∏–±–∫–∞: ${error.message}</p>
                        <button onclick="closeAddToPlaylistModal()" class="btn-secondary" style="margin-top: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
                console.error('Load playlists for modal error:', error);
                if (addBtn) addBtn.disabled = true;
            }
        }

        function selectPlaylist(playlistId) {
            document.querySelectorAll('input[name="playlistSelect"]').forEach(radio => {
                radio.checked = false;
                const item = radio.closest('.playlist-select-item');
                if (item) item.classList.remove('selected');
            });
            const radio = document.getElementById(`playlist_${playlistId}`);
            if (radio) {
                radio.checked = true;
                const item = radio.closest('.playlist-select-item');
                if (item) item.classList.add('selected');
            }
            const addBtn = document.getElementById('addToPlaylistBtn');
            if (addBtn) addBtn.disabled = false;
        }

        function closeAddToPlaylistModal() {
            const modal = document.getElementById('addToPlaylistModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            selectedTrackId = null;
            const addBtn = document.getElementById('addToPlaylistBtn');
            if (addBtn) addBtn.disabled = true;
        }

        async function addTrackToSelectedPlaylist() {
            const selectedRadio = document.querySelector('input[name="playlistSelect"]:checked');
            
            if (!selectedRadio) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç');
                return;
            }

            if (!selectedTrackId) {
                alert('–û—à–∏–±–∫–∞: —Ç—Ä–µ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω');
                closeAddToPlaylistModal();
                return;
            }

            const playlistId = parseInt(selectedRadio.value);
            await addTrackToPlaylist(playlistId, selectedTrackId);
        }

        async function addTrackToPlaylist(playlistId, trackId) {
            try {
                const response = await fetch(`${API_BASE}/playlists/tracks`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playlistId: playlistId,
                        trackId: trackId
                    })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ${response.status}`);
                }

                closeAddToPlaylistModal();
                alert('–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø–ª–µ–π–ª–∏—Å—Ç');
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞: ${error.message}`);
                console.error('Add track to playlist error:', error);
            }
        }

        async function removeTrackFromPlaylist(playlistId, trackId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlists/tracks`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playlistId: playlistId,
                        trackId: trackId
                    })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥ –ø–ª–µ–π–ª–∏—Å—Ç–∞
                viewPlaylist(playlistId);
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞: ${error.message}`);
                console.error('Remove track from playlist error:', error);
            }
        }
    </script>
</body>
</html>
