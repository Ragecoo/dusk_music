<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dusk Music Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(180deg, #E8F4F8 0%, #D1E7F0 50%, #B8D9E8 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 200px;
            color: #1a1a1a;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(74, 144, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(91, 155, 213, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(74, 144, 226, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        /* –§–æ–Ω –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        body.auth-page {
            background: linear-gradient(180deg, #E8F4F8 0%, #D1E7F0 50%, #B8D9E8 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body.auth-page::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(74, 144, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(91, 155, 213, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }



        /* –®–∞–ø–∫–∞ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-header {
            position: relative;
            z-index: 10;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 600;
            color: #4A90E2;
            text-decoration: none;
        }

        .auth-logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .auth-nav-links {
            display: flex;
            gap: 20px;
        }

        .auth-nav-link {
            color: #4A90E2;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }

        .auth-nav-link:hover {
            color: #2c3e50;
            text-decoration: underline;
        }

        .auth-section {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            margin: 40px auto;
            max-width: 450px;
            box-shadow: 0 8px 32px rgba(74, 144, 226, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .auth-section h2 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
            text-align: center;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(74, 144, 226, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a1a;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #4A90E2;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }

        input::placeholder {
            color: rgba(44, 62, 80, 0.5);
        }

        .auth-form-footer {
            margin-top: 20px;
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
        }

        .auth-form-footer a {
            color: #4A90E2;
            text-decoration: none;
            font-weight: 500;
        }

        .auth-form-footer a:hover {
            text-decoration: underline;
        }

        .auth-checkbox-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .auth-checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        .auth-checkbox-group label {
            display: flex;
            align-items: center;
            margin: 0;
            font-weight: normal;
        }

        .auth-form-link {
            color: #4A90E2;
            text-decoration: none;
            font-weight: 500;
        }

        .auth-form-link:hover {
            text-decoration: underline;
        }

        .auth-section.hidden {
            display: none;
        }

        button {
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #4A90E2;
            border: 2px solid #4A90E2;
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: #4A90E2;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .status.success {
            background: rgba(46, 204, 113, 0.15);
            color: #27ae60;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .status.error {
            background: rgba(231, 76, 60, 0.15);
            color: #c0392b;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.2);
            padding-bottom: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.6);
            border: none;
            border-radius: 12px 12px 0 0;
            color: #4A90E2;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #4A90E2;
            font-weight: 600;
            border-bottom-color: #4A90E2;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }

        /* –°–µ—Ç–∫–∏ –¥–ª—è –∞—Ä—Ç–∏—Å—Ç–æ–≤, –∞–ª—å–±–æ–º–æ–≤, —Ç—Ä–µ–∫–æ–≤ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.2);
            background: #fff;
        }

        .card-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 10px;
            object-fit: cover;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .card-subtitle {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .home-section {
            margin-bottom: 40px;
        }

        .home-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .home-section-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
        }

        .home-section-show-all {
            color: #7f8c8d;
            font-size: 0.9em;
            cursor: pointer;
            transition: color 0.3s;
        }

        .home-section-show-all:hover {
            color: #4A90E2;
        }

        .horizontal-scroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 0;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .horizontal-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .horizontal-scroll::-webkit-scrollbar-track {
            background: rgba(74, 144, 226, 0.05);
            border-radius: 4px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb {
            background: rgba(74, 144, 226, 0.3);
            border-radius: 4px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 144, 226, 0.5);
        }

        .horizontal-card {
            flex: 0 0 180px;
            width: 180px;
            min-width: 180px;
            max-width: 180px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.08);
            display: flex;
            flex-direction: column;
        }

        .horizontal-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.15);
            background: #fff;
        }

        .horizontal-card-image {
            width: 100%;
            height: 148px;
            min-height: 148px;
            max-height: 148px;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 12px;
            flex-shrink: 0;
        }

        .horizontal-card-title {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
            flex-shrink: 0;
            line-height: 1.3;
        }

        .horizontal-card-subtitle {
            color: #7f8c8d;
            font-size: 0.85em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 0;
            line-height: 1.3;
        }

        .horizontal-track-card {
            flex: 0 0 180px;
            width: 180px;
            min-width: 180px;
            max-width: 180px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.08);
            display: flex;
            flex-direction: column;
        }

        .horizontal-track-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.15);
            background: #fff;
        }

        .horizontal-track-card-image {
            width: 100%;
            height: 148px;
            min-height: 148px;
            max-height: 148px;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 12px;
            flex-shrink: 0;
        }

        .horizontal-track-card-title {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
            flex-shrink: 0;
            line-height: 1.3;
        }

        .horizontal-track-card-artist {
            color: #7f8c8d;
            font-size: 0.85em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 0;
            line-height: 1.3;
        }

        /* –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ */
        .tracks-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .track-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 18px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.08);
        }

        .track-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.15);
            background: #fff;
        }

        .track-cover {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .track-info {
            flex: 1;
            min-width: 0;
        }

        .track-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .track-artist {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .track-duration {
            color: #95a5a6;
            font-size: 0.85em;
            white-space: nowrap;
        }

        /* –ü–ª–µ–µ—Ä */
        .player-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            border-top: 2px solid rgba(74, 144, 226, 0.2);
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .player-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .player-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 0 0 250px;
        }

        .player-cover {
            width: 70px;
            height: 70px;
            border-radius: 8px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .player-cover:hover {
            transform: scale(1.05);
        }

        .player-info {
            flex: 1;
            min-width: 0;
        }

        .now-playing {
            font-weight: 600;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
            font-size: 0.95em;
        }

        .now-playing-artist {
            color: #7f8c8d;
            font-size: 0.85em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .player-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
        }

        .player-control-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #4A90E2;
            transition: all 0.2s;
        }

        .player-control-btn:hover {
            background: rgba(74, 144, 226, 0.1);
            transform: scale(1.1);
        }

        .player-control-btn:active {
            transform: scale(0.95);
        }

        .player-control-btn.active {
            background: rgba(74, 144, 226, 0.2);
            color: #2c5aa0;
        }

        .player-play-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            color: white;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.3);
        }

        .player-play-btn:hover {
            background: linear-gradient(135deg, #3a7bc2 0%, #4a8bc5 100%);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
        }

        .player-progress-container {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-time {
            font-size: 0.8em;
            color: #7f8c8d;
            min-width: 45px;
            text-align: center;
        }

        .player-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(74, 144, 226, 0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .player-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s;
        }

        .player-progress-handle {
            position: absolute;
            top: 50%;
            left: 0%;
            transform: translate(-50%, -50%);
            width: 14px;
            height: 14px;
            background: #4A90E2;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .player-progress-bar:hover .player-progress-handle {
            opacity: 1;
        }

        .player-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 0 0 150px;
            justify-content: flex-end;
        }

        .player-volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-volume-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #4A90E2;
            transition: all 0.2s;
        }

        .player-volume-btn:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .player-volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(74, 144, 226, 0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .player-volume-fill {
            height: 100%;
            background: #4A90E2;
            border-radius: 2px;
            width: 70%;
        }

        audio {
            display: none;
        }

        .hidden {
            display: none !important;
        }
        

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .breadcrumb {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            color: #4A90E2;
            cursor: pointer;
            font-weight: 500;
        }

        .breadcrumb-item:hover {
            color: #2c3e50;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #95a5a6;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-container {
            margin-bottom: 30px;
            position: relative;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 14px 24px;
            border: 2px solid rgba(74, 144, 226, 0.2);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a1a;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }

        .search-input::placeholder {
            color: rgba(44, 62, 80, 0.5);
        }

        .search-input:focus {
            background: #fff;
            border-color: #4A90E2;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }

        .search-button {
            padding: 12px 30px;
            border-radius: 25px;
            white-space: nowrap;
        }

        .search-results {
            margin-top: 20px;
        }

        .search-results-group {
            margin-bottom: 30px;
        }

        .search-results-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.2);
            color: #2c3e50;
        }

        .search-result-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.08);
        }

        .search-result-item:hover {
            transform: translateX(5px);
            background: #fff;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.15);
        }

        .search-result-cover {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
        }

        .search-result-subtitle {
            color: #7f8c8d;
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .search-result-type {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            background: rgba(74, 144, 226, 0.1);
            color: #4A90E2;
            white-space: nowrap;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal:not(.hidden) {
            animation: fadeIn 0.2s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.8);
            position: relative;
            color: #1a1a1a;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(74, 144, 226, 0.1);
            border: none;
            color: #4A90E2;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
            margin: 0;
        }

        .modal-close:hover {
            background: #4A90E2;
            color: white;
            transform: rotate(90deg);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.8em;
        }

        .playlist-select-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid transparent;
        }

        .playlist-select-item:hover {
            background: rgba(74, 144, 226, 0.1);
            border-color: rgba(74, 144, 226, 0.3);
        }

        .playlist-select-item.selected {
            background: rgba(74, 144, 226, 0.15);
            border: 2px solid #4A90E2;
        }

        .playlist-select-item input[type="radio"] {
            margin-right: 10px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ç—Ä–µ–∫–æ–≤ */
        .track-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .action-button {
            background: transparent;
            border: 1px solid rgba(74, 144, 226, 0.2);
            color: #4A90E2;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            font-weight: 400;
            min-width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-button:hover {
            background: rgba(74, 144, 226, 0.08);
            border-color: rgba(74, 144, 226, 0.4);
            color: #4A90E2;
        }

        .action-button.favorite {
            background: transparent;
            border-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .action-button.favorite:hover {
            background: rgba(220, 53, 69, 0.08);
            border-color: rgba(220, 53, 69, 0.4);
            color: #dc3545;
        }

        .playlist-item {
            position: relative;
        }

        .playlist-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .playlist-action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #666;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 300;
            transition: all 0.15s ease;
            backdrop-filter: blur(10px);
        }

        .playlist-action-btn:hover {
            background: rgba(220, 53, 69, 0.1);
            border-color: rgba(220, 53, 69, 0.3);
            color: #dc3545;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—Ä—Ç–∏—Å—Ç–∞ */
        .artist-profile-section {
            margin-bottom: 40px;
        }

        .artist-profile-header {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.1);
        }

        .artist-profile-photo {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(74, 144, 226, 0.2);
            flex-shrink: 0;
        }

        .artist-profile-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .artist-profile-name {
            font-size: 3em;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .artist-profile-followers {
            font-size: 1.1em;
            color: #7f8c8d;
            font-weight: 500;
        }

        .artist-follow-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            align-self: flex-start;
        }

        .artist-follow-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
        }

        .artist-follow-btn.following {
            background: rgba(74, 144, 226, 0.1);
            color: #4A90E2;
            border: 2px solid #4A90E2;
        }

        .artist-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.1);
            margin-bottom: 30px;
        }

        .artist-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #7f8c8d;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: capitalize;
        }

        .artist-tab:hover {
            color: #4A90E2;
        }

        .artist-tab.active {
            color: #4A90E2;
            border-bottom-color: #4A90E2;
        }

        .artist-content-section {
            min-height: 300px;
        }

        .artist-tracks-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .artist-track-row {
            display: grid;
            grid-template-columns: 40px 60px 1fr auto auto 50px;
            gap: 15px;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .artist-track-row:hover {
            background: rgba(74, 144, 226, 0.05);
        }

        .artist-track-row.playing {
            background: rgba(74, 144, 226, 0.1);
        }

        .artist-track-number {
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: center;
            font-weight: 500;
        }

        .artist-track-play-icon {
            color: #4A90E2;
            font-size: 1.2em;
            text-align: center;
            cursor: pointer;
        }

        .artist-track-cover {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
        }

        .artist-track-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .artist-track-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1em;
        }

        .artist-track-playcount {
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: right;
        }

        .artist-track-duration {
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: right;
        }

        /* –¢—É–ª–±–∞—Ä */
        .toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(74, 144, 226, 0.2);
            display: flex;
            align-items: center;
            padding: 0 30px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 0 0 auto;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
            cursor: pointer;
            user-select: none;
        }

        .menu-button {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            transition: all 0.3s;
        }

        .menu-button:hover {
            opacity: 0.7;
        }

        .menu-button span {
            width: 24px;
            height: 3px;
            background: #2c3e50;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .toolbar-center {
            flex: 1;
            display: flex;
            justify-content: center;
            padding: 0 20px;
        }

        .toolbar-search {
            width: 100%;
            max-width: 600px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .toolbar-search input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            border: 2px solid rgba(74, 144, 226, 0.2);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        .toolbar-search input:focus {
            border-color: #4A90E2;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }

        .toolbar-search-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border-radius: 50%;
            transition: background-color 0.2s;
            margin: 0;
            box-sizing: border-box;
        }

        .toolbar-search-button:hover {
            background: rgba(74, 144, 226, 0.1);
            transform: translateY(-50%);
        }

        .toolbar-search-button:active {
            transform: translateY(-50%);
        }

        .toolbar-search-button img {
            width: 20px;
            height: 20px;
            object-fit: contain;
            display: block;
            margin: 0;
            padding: 0;
            border: none;
            pointer-events: none;
            transform: none;
            transition: none;
        }

        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 0 0 auto;
        }

        .toolbar-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(74, 144, 226, 0.1);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
            color: #4A90E2;
            padding: 0;
        }

        .toolbar-icon img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .toolbar-icon:hover {
            background: rgba(74, 144, 226, 0.2);
            transform: scale(1.1);
        }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar-menu {
            position: fixed;
            top: 70px;
            left: 0;
            width: 300px;
            height: calc(100vh - 70px);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(74, 144, 226, 0.2);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-menu.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(74, 144, 226, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h3 {
            font-size: 1.2em;
            color: #2c3e50;
            margin: 0;
        }

        .create-playlist-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(74, 144, 226, 0.1);
            border: none;
            color: #4A90E2;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .create-playlist-btn:hover {
            background: rgba(74, 144, 226, 0.2);
            transform: scale(1.1);
        }

        .sidebar-content {
            padding: 20px;
        }

        .playlist-menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.5);
        }

        .playlist-menu-item:hover {
            background: rgba(74, 144, 226, 0.1);
            transform: translateX(5px);
        }

        .playlist-menu-cover {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .playlist-menu-info {
            flex: 1;
            min-width: 0;
        }

        .playlist-menu-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .playlist-menu-subtitle {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .sidebar-section-divider {
            height: 1px;
            background: rgba(74, 144, 226, 0.1);
            margin: 10px 20px;
        }

        .sidebar-artists-content {
            max-height: calc(100vh - 400px);
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar-artists-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-artists-content::-webkit-scrollbar-track {
            background: rgba(74, 144, 226, 0.05);
            border-radius: 3px;
        }

        .sidebar-artists-content::-webkit-scrollbar-thumb {
            background: rgba(74, 144, 226, 0.3);
            border-radius: 3px;
        }

        .sidebar-artists-content::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 144, 226, 0.5);
        }

        .artist-menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.5);
        }

        .artist-menu-item:hover {
            background: rgba(74, 144, 226, 0.1);
            transform: translateX(5px);
        }

        .artist-menu-cover {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .artist-menu-info {
            flex: 1;
            min-width: 0;
        }

        .artist-menu-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .menu-overlay {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(2px);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .menu-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-page {
            padding: 20px;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.1);
        }

        .avatar-upload {
            position: relative;
            cursor: pointer;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(74, 144, 226, 0.2);
            transition: all 0.3s;
        }

        .avatar-upload:hover .avatar-preview {
            border-color: #4A90E2;
            transform: scale(1.05);
        }

        .avatar-upload input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .avatar-upload-label {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: #4A90E2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(74, 144, 226, 0.3);
        }

        .profile-info {
            text-align: center;
            width: 100%;
        }

        .profile-name {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .profile-email {
            font-size: 1.1em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .profile-section {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.1);
        }

        .profile-section h3 {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.2);
        }

        .profile-field {
            margin-bottom: 15px;
        }

        .profile-field label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .profile-field-value {
            color: #7f8c8d;
            font-size: 1em;
        }

        .logout-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .logout-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }

        /* –û—Ç—Å—Ç—É–ø –¥–ª—è —Ç—É–ª–±–∞—Ä–∞ */
        body {
            padding-top: 90px;
        }
    </style>
</head>
<body>
    <!-- –¢—É–ª–±–∞—Ä -->
    <div class="toolbar hidden" id="toolbar">
        <div class="toolbar-left">
            <div class="logo" onclick="goHome()">dusk</div>
            <button class="menu-button" onclick="toggleSidebar()" title="–ú–µ–Ω—é">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div class="toolbar-center">
            <div class="toolbar-search">
                <input type="text" id="toolbarSearchInput" placeholder="—á—Ç–æ —Ö–æ—á–µ—à—å –ø–æ—Å–ª—É—à–∞—Ç—å?" onkeypress="handleToolbarSearchKeyPress(event)">
                <button class="toolbar-search-button" onclick="performToolbarSearch()" title="–ü–æ–∏—Å–∫">
                    <img src="http://localhost:8080/api/v1/files/covers/png-clipart-search-icon-computer-icons-android-desktop-search-button-internet-share-icon-thumbnail.png" alt="–ü–æ–∏—Å–∫" onerror="this.style.display='none'; this.parentElement.innerHTML='üîç';">
                </button>
            </div>
        </div>
        <div class="toolbar-right">
            <button class="toolbar-icon" onclick="goHome()" title="–ì–ª–∞–≤–Ω–∞—è">
                <img src="http://localhost:8080/api/v1/files/covers/69524.png" alt="–ì–ª–∞–≤–Ω–∞—è" onerror="this.onerror=null; this.src='http://localhost:8080/api/v1/files/covers/69524.jpg'; this.onerror=function(){this.onerror=null; this.src='http://localhost:8080/api/v1/files/covers/69524.jpeg'; this.onerror=function(){this.style.display='none'; this.parentElement.innerHTML='üè†';};};">
            </button>
            <button class="toolbar-icon" onclick="showProfile()" title="–ü—Ä–æ—Ñ–∏–ª—å">
                <img src="http://localhost:8080/api/v1/files/covers/znachok profilya.png" alt="–ü—Ä–æ—Ñ–∏–ª—å" onerror="this.onerror=null; this.src='http://localhost:8080/api/v1/files/covers/znachok profilya.jpg'; this.onerror=function(){this.onerror=null; this.src='http://localhost:8080/api/v1/files/covers/znachok profilya.jpeg'; this.onerror=function(){this.style.display='none'; this.parentElement.innerHTML='üë§';};};">
            </button>
        </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="menu-overlay" id="menuOverlay" onclick="toggleSidebar()"></div>
    <div class="sidebar-menu" id="sidebarMenu">
        <div class="sidebar-header">
            <h3>–ü–ª–µ–π–ª–∏—Å—Ç—ã</h3>
            <button class="create-playlist-btn" onclick="showCreatePlaylistModal(); toggleSidebar();" title="–°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç">+</button>
        </div>
        <div class="sidebar-content" id="sidebarPlaylistsList">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>
        </div>
        
        <div class="sidebar-section-divider"></div>
        
        <div class="sidebar-header">
            <h3>–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏</h3>
        </div>
        <div class="sidebar-content sidebar-artists-content" id="sidebarArtistsList">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫...</div>
        </div>
    </div>

    <div class="container">
        <h1 class="hidden" id="mainTitle">Dusk Music Player</h1>

    <!-- –®–∞–ø–∫–∞ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-header hidden" id="authHeader">
        <a href="#" class="auth-logo" onclick="goToAuth(); return false;">
            <div class="auth-logo-icon">d</div>
            <span>dusk</span>
        </a>
        <div class="auth-nav-links">
            <a href="#" class="auth-nav-link" onclick="goToAuth(); return false;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a href="#" class="auth-nav-link" onclick="showRegisterForm(); return false;" id="registerLink">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
    </div>

        <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
        <div class="auth-section" id="authSection">
            <h2>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
            <div class="input-group">
                <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input type="email" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ email" value="">
            </div>
            <div class="input-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value="">
            </div>
            <div class="auth-checkbox-group">
                <label>
                    <input type="checkbox" id="rememberMe">
                    –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
                </label>
                <a href="#" class="auth-form-link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
            </div>
            <button onclick="login()" style="width: 100%; padding: 15px; font-size: 16px; margin-bottom: 20px;">–í–æ–π—Ç–∏</button>
            <div class="auth-form-footer">
                –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterForm(); return false;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
            <div id="authStatus"></div>
        </div>

        <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
        <div class="auth-section hidden" id="registerSection">
            <h2>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
            <div class="input-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="registerUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" value="">
            </div>
            <div class="input-group">
                <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input type="email" id="registerEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email" value="">
            </div>
            <div class="input-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="registerPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value="">
            </div>
            <button onclick="register()" style="width: 100%; padding: 15px; font-size: 16px; margin-bottom: 20px; background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%);">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <div class="auth-form-footer">
                –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showLoginForm(); return false;">–í–æ–π—Ç–∏</a>
            </div>
            <div id="registerStatus"></div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="hidden" id="mainContent">
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ (—Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <div id="searchResults" class="search-results hidden"></div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="nav-tabs hidden">
                <button class="nav-tab active" onclick="showTab('home')">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>

            <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
            <div class="breadcrumb hidden" id="breadcrumb">
                <span class="breadcrumb-item" onclick="goHome()">–ì–ª–∞–≤–Ω–∞—è</span>
            </div>

            <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <div id="homeTab" class="tab-content">
                <div class="home-section">
                    <div class="home-section-header">
                        <h2 class="home-section-title">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –í–∞—Å</h2>
                        <span class="home-section-show-all" onclick="showTab('tracks')">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</span>
                    </div>
                    <div class="horizontal-scroll" id="recommendedTracks">
                    </div>
                </div>

                <div class="home-section">
                    <div class="home-section-header">
                        <h2 class="home-section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç—ã</h2>
                        <span class="home-section-show-all" onclick="showTab('artists')">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</span>
                    </div>
                    <div class="horizontal-scroll" id="popularArtists">
                    </div>
                </div>

                <div class="home-section">
                    <div class="home-section-header">
                        <h2 class="home-section-title">–ù–µ–¥–∞–≤–Ω–∏–µ –∞–ª—å–±–æ–º—ã</h2>
                        <span class="home-section-show-all" onclick="showTab('albums')">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</span>
                    </div>
                    <div class="horizontal-scroll" id="recentAlbums">
                    </div>
                </div>

                <div class="home-section">
                    <div class="home-section-header">
                        <h2 class="home-section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏</h2>
                        <span class="home-section-show-all" onclick="showTab('tracks')">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</span>
                    </div>
                    <div class="horizontal-scroll" id="popularTracks">
                    </div>
                </div>
            </div>

            <!-- –ê—Ä—Ç–∏—Å—Ç—ã -->
            <div id="artistsTab" class="tab-content hidden">
                <div class="section-header">
                    <h2>–ê—Ä—Ç–∏—Å—Ç—ã</h2>
                    <button onclick="loadArtists()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div id="artistsList" class="grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤...</div>
                </div>
            </div>

            <!-- –ê–ª—å–±–æ–º—ã -->
            <div id="albumsTab" class="tab-content hidden">
                <div class="section-header">
                    <h2 id="albumsTitle">–ê–ª—å–±–æ–º—ã</h2>
                    <button onclick="loadAlbums()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div id="albumsList" class="grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>
                </div>
            </div>

            <!-- –¢—Ä–µ–∫–∏ -->
            <div id="tracksTab" class="tab-content hidden">
                <div class="section-header">
                    <h2 id="tracksTitle">–¢—Ä–µ–∫–∏</h2>
                    <button onclick="loadTracks()" class="btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div id="tracksList" class="tracks-list">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
            <div id="profileTab" class="tab-content hidden">
                <div class="profile-page">
                    <div class="profile-header">
                        <div class="avatar-upload">
                            <img id="profileAvatar" class="avatar-preview" src="" alt="–ê–≤–∞—Ç–∞—Ä" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'150\' height=\'150\'%3E%3Crect fill=\'%23e0e0e0\' width=\'150\' height=\'150\'/%3E%3C/svg%3E'">
                            <input type="file" id="avatarInput" accept="image/*" onchange="handleAvatarUpload(event)">
                            <div class="avatar-upload-label">üì∑</div>
                        </div>
                        <div class="profile-info">
                            <div id="profileName" class="profile-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                            <div id="profileEmail" class="profile-email">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                    <div class="profile-section">
                        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ</h3>
                        <div class="profile-field">
                            <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                            <div id="profileUsername" class="profile-field-value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                        <div class="profile-field">
                            <label>Email:</label>
                            <div id="profileEmailField" class="profile-field-value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                    <button class="logout-button" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—Ä—Ç–∏—Å—Ç–∞ -->
            <div id="artistPageTab" class="tab-content hidden">
                <div class="artist-profile-section">
                    <div class="artist-profile-header">
                        <img id="artistProfilePhoto" class="artist-profile-photo" src="" alt="Artist" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="artist-profile-info">
                            <h1 id="artistProfileName" class="artist-profile-name"></h1>
                            <div id="artistProfileFollowers" class="artist-profile-followers"></div>
                            <button id="artistFollowBtn" class="artist-follow-btn" onclick="toggleFollowArtist()">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                        </div>
                    </div>
                    <div class="artist-tabs">
                        <button class="artist-tab active" onclick="showArtistTab('tracks')" id="artistTabTracks">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏</button>
                        <button class="artist-tab" onclick="showArtistTab('albums')" id="artistTabAlbums">–ê–ª—å–±–æ–º—ã</button>
                        <button class="artist-tab" onclick="showArtistTab('playlists')" id="artistTabPlaylists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
                    </div>
                </div>
                <div id="artistContentArea">
                    <div id="artistTracksContent" class="artist-content-section">
                        <div id="artistTracksList" class="artist-tracks-list">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>
                        </div>
                    </div>
                    <div id="artistAlbumsContent" class="artist-content-section hidden">
                        <div id="artistAlbumsList" class="grid">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>
                        </div>
                    </div>
                    <div id="artistPlaylistsContent" class="artist-content-section hidden">
                        <div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç—ã –∞—Ä—Ç–∏—Å—Ç–∞ –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
    <div id="createPlaylistModal" class="modal hidden" onclick="if(event.target === this) closeCreatePlaylistModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeCreatePlaylistModal()" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
            <h2>–°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</h2>
            <div class="input-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞:</label>
                <input type="text" id="playlistNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" maxlength="50">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="createPlaylist()" style="flex: 1;">–°–æ–∑–¥–∞—Ç—å</button>
                <button onclick="closeCreatePlaylistModal()" class="btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ –≤ –ø–ª–µ–π–ª–∏—Å—Ç -->
    <div id="addToPlaylistModal" class="modal hidden" onclick="if(event.target === this) closeAddToPlaylistModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeAddToPlaylistModal()" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
            <h2>–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç</h2>
            <div id="playlistsSelectList" style="max-height: 300px; overflow-y: auto; margin: 20px 0;">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="addToPlaylistBtn" onclick="addTrackToSelectedPlaylist()" style="flex: 1;" disabled>–î–æ–±–∞–≤–∏—Ç—å</button>
                <button onclick="closeAddToPlaylistModal()" class="btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ü–ª–µ–µ—Ä -->
    <div class="player-section hidden" id="playerSection">
        <div class="player-content">
            <div class="player-left">
                <img id="playerCover" class="player-cover" src="" alt="Cover">
                <div class="player-info">
                    <div class="now-playing" id="nowPlaying">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</div>
                    <div class="now-playing-artist" id="nowPlayingArtist"></div>
                </div>
            </div>
            <div class="player-center">
                <div class="player-controls">
                    <button class="player-control-btn" id="shuffleBtn" onclick="toggleShuffle()" title="–ü–µ—Ä–µ–º–µ—à–∞—Ç—å">üîÄ</button>
                    <button class="player-control-btn" id="prevBtn" onclick="playPreviousTrack()" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π">‚èÆ</button>
                    <button class="player-control-btn player-play-btn" id="playPauseBtn" onclick="togglePlayPause()" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">‚ñ∂</button>
                    <button class="player-control-btn" id="nextBtn" onclick="playNextTrack()" title="–°–ª–µ–¥—É—é—â–∏–π">‚è≠</button>
                    <button class="player-control-btn" id="repeatBtn" onclick="toggleRepeat()" title="–ü–æ–≤—Ç–æ—Ä">üîÅ</button>
                </div>
                <div class="player-progress-container">
                    <span class="player-time" id="currentTime">0:00</span>
                    <div class="player-progress-bar" id="progressBar" onclick="seekTrack(event)">
                        <div class="player-progress-fill" id="progressFill"></div>
                        <div class="player-progress-handle" id="progressHandle"></div>
                    </div>
                    <span class="player-time" id="totalTime">0:00</span>
                </div>
            </div>
            <div class="player-right">
                <div class="player-volume-container">
                    <button class="player-volume-btn" id="volumeBtn" onclick="toggleMute()" title="–ì—Ä–æ–º–∫–æ—Å—Ç—å">üîä</button>
                    <div class="player-volume-slider" id="volumeSlider" onclick="setVolume(event)">
                        <div class="player-volume-fill" id="volumeFill"></div>
                    </div>
                </div>
            </div>
        </div>
        <audio id="audioPlayer">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
        </audio>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        let token = localStorage.getItem('token') || '';
        let currentTrack = null;
        let currentView = { type: 'artists', artistId: null, albumId: null };
        
        // –ü–ª–µ–µ—Ä
        let playlist = []; // –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        let currentTrackIndex = -1; // –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ
        let isShuffle = false; // –†–µ–∂–∏–º –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
        let repeatMode = 'none'; // 'none', 'all', 'one'
        let isPlaying = false;
        let volume = 0.7; // –ì—Ä–æ–º–∫–æ—Å—Ç—å –æ—Ç 0 –¥–æ 1

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            // –í–°–ï–ì–î–ê –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å–∞–π—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const addModal = document.getElementById('addToPlaylistModal');
            const createModal = document.getElementById('createPlaylistModal');
            if (addModal) {
                addModal.classList.add('hidden');
            }
            if (createModal) {
                createModal.classList.add('hidden');
            }
            
            // –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ localStorage
            token = '';
            localStorage.removeItem('token');
            
            // –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –∏ —Å–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
            const authSection = document.getElementById('authSection');
            const mainContent = document.getElementById('mainContent');
            const toolbar = document.getElementById('toolbar');
            const mainTitle = document.getElementById('mainTitle');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (authSection && !authSection.classList.contains('hidden')) {
                document.body.classList.add('auth-page');
                const authHeader = document.getElementById('authHeader');
                if (authHeader) authHeader.classList.remove('hidden');
            }
            
            if (authSection) {
                authSection.classList.remove('hidden');
            }
            if (mainContent) {
                mainContent.classList.add('hidden');
            }
            if (toolbar) {
                toolbar.classList.add('hidden');
            }
            if (mainTitle) {
                mainTitle.classList.remove('hidden');
            }
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤—Ö–æ–¥–∞
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const authStatus = document.getElementById('authStatus');
            
            if (usernameInput) usernameInput.value = '';
            if (passwordInput) passwordInput.value = '';
            if (authStatus) authStatus.innerHTML = '';
        };

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
        function showLoginForm() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('authStatus').innerHTML = '';
            document.getElementById('registerStatus').innerHTML = '';
        }

        function showRegisterForm() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('registerSection').classList.remove('hidden');
            document.getElementById('authStatus').innerHTML = '';
            document.getElementById('registerStatus').innerHTML = '';
        }

        function goToAuth() {
            showLoginForm();
            document.body.classList.add('auth-page');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('toolbar').classList.add('hidden');
            document.getElementById('mainTitle').classList.remove('hidden');
            const authHeader = document.getElementById('authHeader');
            if (authHeader) authHeader.classList.remove('hidden');
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const statusDiv = document.getElementById('authStatus');

            if (!username || !password) {
                statusDiv.innerHTML = '<div class="status error">–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å</div>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        usernameOrEmail: username,
                        password: password 
                    })
                });

                if (!response.ok) {
                    let errorMessage = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.error || '–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    statusDiv.innerHTML = `<div class="status error">${errorMessage}</div>`;
                    return;
                }

                const data = await response.json();

                if (data.accessToken) {
                    token = data.accessToken;
                    localStorage.setItem('token', token);
                    statusDiv.innerHTML = '<div class="status success">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</div>';
                    
                    document.body.classList.remove('auth-page');
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('registerSection').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    document.getElementById('toolbar').classList.remove('hidden');
                    document.getElementById('mainTitle').classList.add('hidden');
                    document.getElementById('authHeader').classList.add('hidden');
                    loadProfile();
                    loadSidebarPlaylists();
                    loadSidebarArtists();
                    showTab('home');
                } else {
                    statusDiv.innerHTML = '<div class="status error">–¢–æ–∫–µ–Ω –Ω–µ –ø–æ–ª—É—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8080</div>`;
                console.error('Login error:', error);
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const statusDiv = document.getElementById('registerStatus');

            if (!username || !email || !password) {
                statusDiv.innerHTML = '<div class="status error">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è</div>';
                return;
            }

            if (password.length < 8) {
                statusDiv.innerHTML = '<div class="status error">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</div>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        username: username.trim(),
                        email: email.trim(),
                        password: password
                    })
                });

                if (!response.ok) {
                    let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    statusDiv.innerHTML = `<div class="status error">${errorMessage}</div>`;
                    return;
                }

                const data = await response.json();

                if (data.accessToken) {
                    token = data.accessToken;
                    localStorage.setItem('token', token);
                    statusDiv.innerHTML = '<div class="status success">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...</div>';
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    setTimeout(() => {
                        document.body.classList.remove('auth-page');
                        document.getElementById('registerSection').classList.add('hidden');
                        document.getElementById('authSection').classList.add('hidden');
                        document.getElementById('mainContent').classList.remove('hidden');
                        document.getElementById('toolbar').classList.remove('hidden');
                        document.getElementById('mainTitle').classList.add('hidden');
                        document.getElementById('authHeader').classList.add('hidden');
                        loadProfile();
                        loadSidebarPlaylists();
                        loadSidebarArtists();
                        showTab('home');
                    }, 1000);
                } else {
                    statusDiv.innerHTML = '<div class="status error">–¢–æ–∫–µ–Ω –Ω–µ –ø–æ–ª—É—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8080</div>`;
                console.error('Register error:', error);
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            document.getElementById('searchResults').classList.add('hidden');
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            // –û—á–∏—â–∞–µ–º –ø–æ–∏—Å–∫ –≤ —Ç—É–ª–±–∞—Ä–µ
            const toolbarSearchInput = document.getElementById('toolbarSearchInput');
            if (toolbarSearchInput) {
                toolbarSearchInput.value = '';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('profileTab').classList.add('hidden');
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã –≤—Å–µ–≥–¥–∞ —Å–∫—Ä—ã—Ç—ã
            const navTabs = document.querySelector('.nav-tabs');
            if (navTabs) {
                navTabs.classList.add('hidden');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            const activeTab = document.querySelector(`.nav-tab[onclick="showTab('${tabName}')"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            if (tabName === 'profile') {
                document.getElementById('profileTab').classList.remove('hidden');
                showProfile();
                return;
            }
            
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // –ï—Å–ª–∏ –≤—ã–∑–≤–∞–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
                const buttons = document.querySelectorAll('.nav-tab');
                if (tabName === 'artists') buttons[0].classList.add('active');
                else if (tabName === 'albums') buttons[1].classList.add('active');
                else if (tabName === 'tracks') buttons[2].classList.add('active');
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            currentView = { type: tabName, artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            if (tabName === 'home') {
                loadHomePage();
            } else if (tabName === 'artists') {
                loadArtists();
            } else if (tabName === 'albums') {
                loadAlbums();
            } else if (tabName === 'tracks') {
                loadTracks();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadHomePage() {
            await Promise.all([
                loadRecommendedTracks(),
                loadPopularArtists(),
                loadRecentAlbums(),
                loadPopularTracks()
            ]);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
        async function loadRecommendedTracks() {
            const container = document.getElementById('recommendedTracks');
            if (!container) return;
            container.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/tracks?size=10&sort=playCount,desc`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    return;
                }

                container.innerHTML = tracks.map(track => {
                    const coverUrl = getTrackCoverUrl(track, 180);
                    return `
                        <div class="horizontal-track-card" onclick="playTrack(${track.id})">
                            <img class="horizontal-track-card-image" src="${coverUrl}" alt="${escapeHtml(track.title || '–¢—Ä–µ–∫')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'%3E%3Crect fill=\'%23e0e0e0\' width=\'180\' height=\'180\'/%3E%3C/svg%3E'">
                            <div class="horizontal-track-card-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="horizontal-track-card-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                        </div>
                    `;
                }).join('');

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç
                playlist = tracks;
                currentView = { type: 'home', section: 'recommended' };
            } catch (error) {
                console.error('Load recommended tracks error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤
        async function loadPopularArtists() {
            const container = document.getElementById('popularArtists');
            if (!container) return;
            container.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/artists?size=10`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                const artists = data.content || [];

                if (artists.length === 0) {
                    return;
                }

                container.innerHTML = artists.map(artist => {
                    const coverUrl = artist.photoUrl ? getImageUrl(artist.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'%3E%3Crect fill=\'%23e0e0e0\' width=\'180\' height=\'180\'/%3E%3C/svg%3E';
                    return `
                        <div class="horizontal-card" onclick="viewArtist(${artist.id})">
                            <img class="horizontal-card-image" src="${coverUrl}" alt="${escapeHtml(artist.name || '–ê—Ä—Ç–∏—Å—Ç')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'%3E%3Crect fill=\'%23e0e0e0\' width=\'180\' height=\'180\'/%3E%3C/svg%3E'">
                            <div class="horizontal-card-title">${escapeHtml(artist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Load popular artists error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–¥–∞–≤–Ω–∏—Ö –∞–ª—å–±–æ–º–æ–≤
        async function loadRecentAlbums() {
            const container = document.getElementById('recentAlbums');
            if (!container) return;
            container.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/albums?size=10&sort=releaseDate,desc`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                const albums = data.content || [];

                if (albums.length === 0) {
                    return;
                }

                container.innerHTML = albums.map(album => {
                    const coverUrl = album.photoUrl ? getImageUrl(album.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'%3E%3Crect fill=\'%23e0e0e0\' width=\'180\' height=\'180\'/%3E%3C/svg%3E';
                    return `
                        <div class="horizontal-card" onclick="viewAlbum(${album.id})">
                            <img class="horizontal-card-image" src="${coverUrl}" alt="${escapeHtml(album.title || '–ê–ª—å–±–æ–º')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'%3E%3Crect fill=\'%23e0e0e0\' width=\'180\' height=\'180\'/%3E%3C/svg%3E'">
                            <div class="horizontal-card-title">${escapeHtml(album.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="horizontal-card-subtitle">${escapeHtml(album.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Load recent albums error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
        async function loadPopularTracks() {
            const container = document.getElementById('popularTracks');
            if (!container) return;
            container.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/tracks?size=10&sort=playCount,desc`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    return;
                }

                container.innerHTML = tracks.map(track => {
                    const coverUrl = getTrackCoverUrl(track, 180);
                    return `
                        <div class="horizontal-track-card" onclick="playTrack(${track.id})">
                            <img class="horizontal-track-card-image" src="${coverUrl}" alt="${escapeHtml(track.title || '–¢—Ä–µ–∫')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'%3E%3Crect fill=\'%23e0e0e0\' width=\'180\' height=\'180\'/%3E%3C/svg%3E'">
                            <div class="horizontal-track-card-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="horizontal-track-card-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                        </div>
                    `;
                }).join('');

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç
                if (!playlist || playlist.length === 0) {
                    playlist = tracks;
                    currentView = { type: 'home', section: 'popular' };
                }
            } catch (error) {
                console.error('Load popular tracks error:', error);
            }
        }

        function goHome() {
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞—Ä—Ç–∏—Å—Ç–∞ –∏ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('artistPageTab').classList.add('hidden');
            document.getElementById('profileTab').classList.add('hidden');
            currentArtistId = null;
            currentArtistData = null;
            currentView = { type: 'artists', artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ–∏—Å–∫–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã
            const searchContainer = document.querySelector('.search-container');
            if (searchContainer) {
                searchContainer.classList.remove('hidden');
            }
            // –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã —Å–∫—Ä—ã—Ç—ã
            const navTabs = document.querySelector('.nav-tabs');
            if (navTabs) {
                navTabs.classList.add('hidden');
            }
            
            showTab('home');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫–æ–≤—ã–º –º–µ–Ω—é
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebarMenu');
            const overlay = document.getElementById('menuOverlay');
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('open');
                loadSidebarPlaylists();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –≤ –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é
        async function loadSidebarPlaylists() {
            const playlistsListDiv = document.getElementById('sidebarPlaylistsList');
            if (!playlistsListDiv) return;
            
            playlistsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/playlists/my-playlists`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const playlists = await response.json();

                if (playlists.length === 0) {
                    playlistsListDiv.innerHTML = '<div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                playlistsListDiv.innerHTML = playlists.map(playlist => {
                    const coverStyle = playlist.isFavorite 
                        ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 2em; color: white;'
                        : 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
                    const coverContent = playlist.isFavorite ? '‚ô°' : '';
                    
                    return `
                        <div class="playlist-menu-item" onclick="viewPlaylist(${playlist.id}); toggleSidebar();">
                            <div class="playlist-menu-cover" style="${coverStyle}">${coverContent}</div>
                            <div class="playlist-menu-info">
                                <div class="playlist-menu-name">${escapeHtml(playlist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="playlist-menu-subtitle">${playlist.track ? playlist.track.length : 0} —Ç—Ä–µ–∫–æ–≤</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                playlistsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
                console.error('Load sidebar playlists error:', error);
            }
        }

        async function loadSidebarArtists() {
            const artistsListDiv = document.getElementById('sidebarArtistsList');
            if (!artistsListDiv) return;
            
            artistsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫...</div>';

            try {
                const response = await fetch(`${API_BASE}/artists/my-favorites?size=100`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const data = await response.json();
                const artists = data.content || [];

                if (artists.length === 0) {
                    artistsListDiv.innerHTML = '<div class="loading">–ü–æ–¥–ø–∏—Å–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                artistsListDiv.innerHTML = artists.map(artist => {
                    const coverUrl = artist.photoUrl ? getImageUrl(artist.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E';
                    
                    return `
                        <div class="artist-menu-item" onclick="viewArtist(${artist.id}); toggleSidebar();">
                            <img class="artist-menu-cover" src="${coverUrl}" alt="${escapeHtml(artist.name || '–ê—Ä—Ç–∏—Å—Ç')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                            <div class="artist-menu-info">
                                <div class="artist-menu-name">${escapeHtml(artist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                artistsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
                console.error('Load sidebar artists error:', error);
            }
        }

        // –ü–æ–∏—Å–∫ –∏–∑ —Ç—É–ª–±–∞—Ä–∞
        function handleToolbarSearchKeyPress(event) {
            if (event.key === 'Enter') {
                performToolbarSearch();
            }
        }

        function performToolbarSearch() {
            const query = document.getElementById('toolbarSearchInput').value.trim();
            if (query) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞
                document.getElementById('searchInput')?.remove(); // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π input –µ—Å–ª–∏ –µ—Å—Ç—å
                performSearchWithQuery(query);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
        async function performSearchWithQuery(query) {
            const searchResultsDiv = document.getElementById('searchResults');

            if (!query) {
                searchResultsDiv.classList.add('hidden');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã –æ–±—Ä–∞—Ç–Ω–æ
                const navTabs = document.querySelector('.nav-tabs');
                if (navTabs) {
                    navTabs.classList.remove('hidden');
                }
                return;
            }

            searchResultsDiv.innerHTML = '<div class="loading">–ü–æ–∏—Å–∫...</div>';
            searchResultsDiv.classList.remove('hidden');

            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
            const navTabs = document.querySelector('.nav-tabs');
            if (navTabs) {
                navTabs.classList.add('hidden');
            }

            try {
                const response = await fetch(`${API_BASE}/search?query=${encodeURIComponent(query)}&size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                const results = data.content || [];

                if (results.length === 0) {
                    searchResultsDiv.innerHTML = '<div class="loading">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–∏–ø—É
                const tracks = results.filter(r => r.type === 'track');
                const artists = results.filter(r => r.type === 'artist');
                const albums = results.filter(r => r.type === 'album');

                let html = '';

                // –¢—Ä–µ–∫–∏
                if (tracks.length > 0) {
                    html += '<div class="search-results-group">';
                    html += '<div class="search-results-title">–¢—Ä–µ–∫–∏ (' + tracks.length + ')</div>';
                    html += tracks.map(track => {
                        const coverUrl = track.coverUrl ? getImageUrl(track.coverUrl) : `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='50' height='50'%3E%3Crect fill='%23e0e0e0' width='50' height='50'/%3E%3C/svg%3E`;
                        return `
                        <div class="search-result-item" onclick="playTrack(${track.id}, null)">
                            <img class="search-result-cover" src="${coverUrl}" alt="Cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'">
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(track.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="search-result-subtitle">${escapeHtml(track.subtitle || '')}</div>
                            </div>
                            <div class="search-result-type">–¢—Ä–µ–∫</div>
                        </div>
                    `;
                    }).join('');
                    html += '</div>';
                }

                // –ê—Ä—Ç–∏—Å—Ç—ã
                if (artists.length > 0) {
                    html += '<div class="search-results-group">';
                    html += '<div class="search-results-title">–ê—Ä—Ç–∏—Å—Ç—ã (' + artists.length + ')</div>';
                    html += artists.map(artist => `
                        <div class="search-result-item" onclick="viewArtist(${artist.id})">
                            <img class="search-result-cover" src="${artist.coverUrl ? getImageUrl(artist.coverUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'}" alt="Artist" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'">
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(artist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="search-result-subtitle">${escapeHtml(artist.subtitle || '')}</div>
                            </div>
                            <div class="search-result-type">–ê—Ä—Ç–∏—Å—Ç</div>
                        </div>
                    `).join('');
                    html += '</div>';
                }

                // –ê–ª—å–±–æ–º—ã
                if (albums.length > 0) {
                    html += '<div class="search-results-group">';
                    html += '<div class="search-results-title">–ê–ª—å–±–æ–º—ã (' + albums.length + ')</div>';
                    html += albums.map(album => `
                        <div class="search-result-item" onclick="viewAlbum(${album.id})">
                            <img class="search-result-cover" src="${album.coverUrl ? getImageUrl(album.coverUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'}" alt="Album" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23e0e0e0\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'">
                            <div class="search-result-info">
                                <div class="search-result-name">${escapeHtml(album.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="search-result-subtitle">${escapeHtml(album.subtitle || '')}</div>
                            </div>
                            <div class="search-result-type">–ê–ª—å–±–æ–º</div>
                        </div>
                    `).join('');
                    html += '</div>';
                }

                searchResultsDiv.innerHTML = html;

            } catch (error) {
                searchResultsDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}</div>`;
                console.error('Search error:', error);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        async function showProfile() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞—Ä—Ç–∏—Å—Ç–∞
            document.getElementById('artistPageTab').classList.add('hidden');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            document.getElementById('searchResults').classList.add('hidden');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ–∏—Å–∫–∞
            const searchContainer = document.querySelector('.search-container');
            if (searchContainer) {
                searchContainer.classList.add('hidden');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã
            const navTabs = document.querySelector('.nav-tabs');
            if (navTabs) {
                navTabs.classList.add('hidden');
            }
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è
            const profileTab = document.getElementById('profileTab');
            if (profileTab) {
                profileTab.classList.remove('hidden');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
            await loadProfile();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
        async function loadProfile() {
            try {
                const response = await fetch(`${API_BASE}/profile/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}${errorText ? ' - ' + errorText : ''}`);
                }

                const user = await response.json();

                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                document.getElementById('profileName').textContent = user.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('profileEmail').textContent = user.email || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                document.getElementById('profileUsername').textContent = user.username || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                document.getElementById('profileEmailField').textContent = user.email || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å
                if (user.avatarUrl) {
                    document.getElementById('profileAvatar').src = getImageUrl(user.avatarUrl);
                } else {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º placeholder, –µ—Å–ª–∏ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–µ—Ç
                    document.getElementById('profileAvatar').src = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'150\' height=\'150\'%3E%3Crect fill=\'%23e0e0e0\' width=\'150\' height=\'150\'/%3E%3C/svg%3E';
                }
            } catch (error) {
                console.error('Load profile error:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ —á–µ—Ä–µ–∑ alert, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('profileName').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('profileEmail').textContent = error.message;
                document.getElementById('profileUsername').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('profileEmailField').textContent = '–û—à–∏–±–∫–∞';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
        async function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5 –ú–ë');
                return;
            }

            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch(`${API_BASE}/profile/avatar`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                        // –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Content-Type –¥–ª—è FormData - –±—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å boundary
                    },
                    body: formData
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}${errorText ? ' - ' + errorText : ''}`);
                }

                const data = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
                if (data.avatarUrl) {
                    document.getElementById('profileAvatar').src = getImageUrl(data.avatarUrl);
                }
                
                alert('–ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω');
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                await loadProfile();
                
            } catch (error) {
                console.error('Upload avatar error:', error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞: ${error.message}`);
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                token = '';
                localStorage.removeItem('token');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏ —Ç—É–ª–±–∞—Ä
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('toolbar').classList.add('hidden');
                document.getElementById('mainTitle').classList.remove('hidden');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
                document.body.classList.add('auth-page');
                const authHeader = document.getElementById('authHeader');
                if (authHeader) authHeader.classList.remove('hidden');
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('registerSection').classList.add('hidden');
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤—Ö–æ–¥–∞
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('authStatus').innerHTML = '';
                document.getElementById('registerStatus').innerHTML = '';
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
                const sidebar = document.getElementById('sidebarMenu');
                const overlay = document.getElementById('menuOverlay');
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤
        async function loadArtists() {
            const artistsListDiv = document.getElementById('artistsList');
            artistsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/artists?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const artists = data.content || [];

                if (artists.length === 0) {
                    artistsListDiv.innerHTML = '<div class="loading">–ê—Ä—Ç–∏—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                artistsListDiv.innerHTML = artists.map(artist => `
                    <div class="card" onclick="viewArtist(${artist.id})">
                        <img class="card-image" src="${getImageUrl(artist.photoUrl)}" alt="${escapeHtml(artist.name || '–ê—Ä—Ç–∏—Å—Ç')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="card-title">${escapeHtml(artist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                    </div>
                `).join('');
            } catch (error) {
                artistsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∞—Ä—Ç–∏—Å—Ç–∞ (–∞–ª—å–±–æ–º—ã –∞—Ä—Ç–∏—Å—Ç–∞)
        let currentArtistId = null;
        let currentArtistData = null;

        async function viewArtist(artistId) {
            currentArtistId = artistId;
            currentView = { type: 'artist', artistId: artistId, albumId: null };
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏
            document.getElementById('breadcrumb').classList.add('hidden');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±—ã
            const navTabs = document.querySelector('.nav-tabs');
            if (navTabs) {
                navTabs.classList.add('hidden');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞—Ä—Ç–∏—Å—Ç–∞
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById('artistPageTab').classList.remove('hidden');
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç–∞
            try {
                const response = await fetch(`${API_BASE}/artists/${artistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const artist = await response.json();
                currentArtistData = artist;

                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –∞—Ä—Ç–∏—Å—Ç–∞
                document.getElementById('artistProfileName').textContent = artist.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç';
                document.getElementById('artistProfilePhoto').src = artist.photoUrl ? getImageUrl(artist.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E';
                document.getElementById('artistProfileFollowers').textContent = `${artist.followers || 0} —Å–ª—É—à–∞—Ç–µ–ª–µ–π`;
                
                const followBtn = document.getElementById('artistFollowBtn');
                if (artist.followed) {
                    followBtn.textContent = '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è';
                    followBtn.classList.add('following');
                } else {
                    followBtn.textContent = '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                    followBtn.classList.remove('following');
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                showArtistTab('tracks');
            } catch (error) {
                console.error('Error loading artist:', error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ç–∏—Å—Ç–∞: ${error.message}`);
            }
        }

        async function showArtistTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.artist-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`artistTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('.artist-content-section').forEach(section => section.classList.add('hidden'));
            
            if (tabName === 'tracks') {
                document.getElementById('artistTracksContent').classList.remove('hidden');
                await loadArtistTracks();
            } else if (tabName === 'albums') {
                document.getElementById('artistAlbumsContent').classList.remove('hidden');
                await loadArtistAlbums();
            } else if (tabName === 'playlists') {
                document.getElementById('artistPlaylistsContent').classList.remove('hidden');
            }
        }

        async function loadArtistTracks() {
            if (!currentArtistId) return;
            
            const tracksListDiv = document.getElementById('artistTracksList');
            tracksListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/artists/${currentArtistId}/tracks?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç
                playlist = tracks;
                currentView = { type: 'artist', artistId: currentArtistId, albumId: null };
                
                tracksListDiv.innerHTML = tracks.map((track, index) => {
                    const coverUrl = getTrackCoverUrl(track);
                    const isPlaying = currentTrack && currentTrack.id === track.id;
                    return `
                        <div class="artist-track-row ${isPlaying ? 'playing' : ''}" onclick="playTrack(${track.id})">
                            <div class="artist-track-number">${index + 1}</div>
                            <img class="artist-track-cover" src="${coverUrl}" alt="Cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                            <div class="artist-track-info">
                                <div class="artist-track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            </div>
                            <div class="artist-track-playcount">${track.playCount || 0}</div>
                            <div class="artist-track-duration">${formatDuration(track.durationSec || track.duration || 0)}</div>
                            <button class="action-button favorite" onclick="event.stopPropagation(); toggleFavorite(${track.id})" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ô°</button>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                tracksListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        async function loadArtistAlbums() {
            if (!currentArtistId) return;
            
            const albumsListDiv = document.getElementById('artistAlbumsList');
            albumsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/albums/artist/${currentArtistId}?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const data = await response.json();
                const albums = data.content || [];

                if (albums.length === 0) {
                    albumsListDiv.innerHTML = '<div class="loading">–ê–ª—å–±–æ–º–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                albumsListDiv.innerHTML = albums.map(album => `
                    <div class="card" onclick="viewAlbum(${album.id})">
                        <img class="card-image" src="${album.photoUrl ? getImageUrl(album.photoUrl) : 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'}" alt="${escapeHtml(album.title || '–ê–ª—å–±–æ–º')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="card-title">${escapeHtml(album.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        <div class="card-subtitle">${escapeHtml(album.artist?.name || '')}</div>
                    </div>
                `).join('');
            } catch (error) {
                albumsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        async function toggleFollowArtist() {
            if (!currentArtistId) return;
            
            try {
                const response = await fetch(`${API_BASE}/artists/${currentArtistId}/follow`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                if (currentArtistData) {
                    currentArtistData.followed = !currentArtistData.followed;
                    const followBtn = document.getElementById('artistFollowBtn');
                    if (currentArtistData.followed) {
                        followBtn.textContent = '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è';
                        followBtn.classList.add('following');
                        currentArtistData.followers = (currentArtistData.followers || 0) + 1;
                    } else {
                        followBtn.textContent = '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                        followBtn.classList.remove('following');
                        currentArtistData.followers = Math.max(0, (currentArtistData.followers || 0) - 1);
                    }
                    document.getElementById('artistProfileFollowers').textContent = `${currentArtistData.followers || 0} —Å–ª—É—à–∞—Ç–µ–ª–µ–π`;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ sidebar
                loadSidebarArtists();
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                console.error('Toggle follow error:', error);
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–ª—å–±–æ–º–∞ (—Ç—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞)
        let currentAlbumData = null;

        async function viewAlbum(albumId) {
            currentView = { type: 'tracks', artistId: null, albumId: albumId };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.getElementById('breadcrumb').innerHTML = `
                <span class="breadcrumb-item" onclick="goHome()">–ì–ª–∞–≤–Ω–∞—è</span>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item" onclick="showTab('albums')">–ê–ª—å–±–æ–º—ã</span>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item">–¢—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞</span>
            `;
            document.getElementById('breadcrumb').classList.remove('hidden');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –¥—Ä—É–≥–∏–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById('homeTab').classList.add('hidden');
            document.getElementById('artistPageTab').classList.add('hidden');
            document.getElementById('profileTab').classList.add('hidden');
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–∫–æ–≤
            const tracksTab = document.getElementById('tracksTab');
            if (!tracksTab) {
                console.error('tracksTab element not found');
                return;
            }
            tracksTab.classList.remove('hidden');
            
            const tracksListDiv = document.getElementById('tracksList');
            if (!tracksListDiv) {
                console.error('tracksList element not found');
                return;
            }
            tracksListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/albums/${albumId}/tracks?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–ª—å–±–æ–º–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–ª–æ–∂–∫–∏
                let albumPhotoUrl = null;
                try {
                    const albumResponse = await fetch(`${API_BASE}/albums/${albumId}`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (albumResponse.ok) {
                        const albumData = await albumResponse.json();
                        currentAlbumData = albumData;
                        albumPhotoUrl = albumData.photoUrl;
                    }
                } catch (e) {
                    console.error('Error loading album data:', e);
                }

                // –û–±–æ–≥–∞—â–∞–µ–º —Ç—Ä–µ–∫–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–ª—å–±–æ–º–∞, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
                const enrichedTracks = tracks.map(track => {
                    if (!track.album && albumPhotoUrl) {
                        track.album = { photoUrl: albumPhotoUrl };
                    }
                    if (!track.coverUrl && albumPhotoUrl) {
                        track.coverUrl = albumPhotoUrl;
                    }
                    return track;
                });

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç
                playlist = enrichedTracks;
                currentView = { type: 'tracks', artistId: null, albumId: albumId };
                
                tracksListDiv.innerHTML = enrichedTracks.map(track => {
                    const coverUrl = getTrackCoverUrl(track);
                    const duration = track.duration || track.durationSec || 0;
                    const artistName = track.artist?.name || track.artistName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç';
                    return `
                    <div class="track-item" onclick="playTrack(${track.id})">
                        <img class="track-cover" src="${coverUrl}" alt="Cover" onclick="playTrack(${track.id})" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'" style="cursor: pointer;">
                        <div class="track-info" onclick="playTrack(${track.id})" style="cursor: pointer; flex: 1;">
                            <div class="track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="track-artist">${escapeHtml(artistName)}</div>
                        </div>
                        <div class="track-duration">${formatDuration(duration)}</div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                tracksListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∞–ª—å–±–æ–º–æ–≤
        async function loadAlbums() {
            currentView = { type: 'albums', artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            const albumsListDiv = document.getElementById('albumsList');
            albumsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/albums?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const albums = data.content || [];

                if (albums.length === 0) {
                    albumsListDiv.innerHTML = '<div class="loading">–ê–ª—å–±–æ–º–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                albumsListDiv.innerHTML = albums.map(album => `
                    <div class="card" onclick="viewAlbum(${album.id})">
                        <img class="card-image" src="${getImageUrl(album.photoUrl)}" alt="${escapeHtml(album.title || '–ê–ª—å–±–æ–º')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23e0e0e0\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'">
                        <div class="card-title">${escapeHtml(album.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        <div class="card-subtitle">${escapeHtml(album.artist?.name || '')}</div>
                    </div>
                `).join('');
            } catch (error) {
                albumsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤
        async function loadTracks() {
            currentView = { type: 'tracks', artistId: null, albumId: null };
            document.getElementById('breadcrumb').classList.add('hidden');
            
            const tracksListDiv = document.getElementById('tracksList');
            tracksListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/tracks?size=50`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                const data = await response.json();
                const tracks = data.content || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç
                playlist = tracks;
                currentView = { type: 'tracks', artistId: null, albumId: null };
                
                tracksListDiv.innerHTML = tracks.map(track => {
                    const coverUrl = getTrackCoverUrl(track);
                    return `
                    <div class="track-item">
                        <img class="track-cover" src="${coverUrl}" alt="Cover" onclick="playTrack(${track.id})" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'" style="cursor: pointer;">
                        <div class="track-info" onclick="playTrack(${track.id})" style="cursor: pointer; flex: 1;">
                            <div class="track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                            <div class="track-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                        </div>
                        <div class="track-actions">
                            <button class="action-button favorite" onclick="event.stopPropagation(); toggleFavorite(${track.id})" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ô°</button>
                            <button class="action-button" onclick="event.stopPropagation(); showAddToPlaylistModal(${track.id})" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç">+</button>
                            <div class="track-duration">${formatDuration(track.duration || 0)}</div>
                        </div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                tracksListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
        async function playTrack(trackId, trackList = null) {
            try {
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤, –æ–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π–ª–∏—Å—Ç
                if (trackList && Array.isArray(trackList)) {
                    playlist = trackList;
                    currentTrackIndex = trackList.findIndex(t => t.id === trackId);
                    if (currentTrackIndex === -1) currentTrackIndex = 0;
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç—Ä–µ–∫ –≤ —Ç–µ–∫—É—â–µ–º –ø–ª–µ–π–ª–∏—Å—Ç–µ
                    currentTrackIndex = playlist.findIndex(t => t.id === trackId);
                    
                    // –ï—Å–ª–∏ —Ç—Ä–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π–ª–∏—Å—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
                    if (currentTrackIndex === -1) {
                        await updatePlaylistFromContext();
                        currentTrackIndex = playlist.findIndex(t => t.id === trackId);
                    }
                    
                    // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–∫ –æ—Ç–¥–µ–ª—å–Ω–æ
                    if (currentTrackIndex === -1) {
                        const response = await fetch(`${API_BASE}/tracks/${trackId}`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (response.ok) {
                            const track = await response.json();
                            playlist = [track];
                            currentTrackIndex = 0;
                        } else {
                            throw new Error('–¢—Ä–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        }
                    }
                }

                if (currentTrackIndex === -1 || !playlist[currentTrackIndex]) {
                    throw new Error('–¢—Ä–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ');
                }

                let track = playlist[currentTrackIndex];
                currentTrack = track;

                // –ï—Å–ª–∏ audioUrl –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞
                if (!track.audioUrl) {
                    try {
                        const response = await fetch(`${API_BASE}/tracks/${trackId}`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (response.ok) {
                            const fullTrack = await response.json();
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–∫ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ
                            playlist[currentTrackIndex] = fullTrack;
                            track = fullTrack;
                            currentTrack = fullTrack;
                        }
                    } catch (error) {
                        console.error('Error loading full track data:', error);
                    }
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∞—É–¥–∏–æ
                let audioUrl = track.audioUrl;
                if (!audioUrl) {
                    throw new Error('audioUrl –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–∞');
                }

                if (!audioUrl.startsWith('http')) {
                    if (audioUrl.startsWith('audio/') || audioUrl.startsWith('covers/')) {
                        audioUrl = `http://localhost:8080/api/v1/files/${audioUrl}`;
                    } else if (audioUrl.startsWith('/')) {
                        audioUrl = `http://localhost:8080${audioUrl}`;
                    } else {
                        audioUrl = `http://localhost:8080/api/v1/files/audio/${audioUrl}`;
                    }
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = audioUrl;
                audioPlayer.volume = volume;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø–ª–µ–µ—Ä–µ
                document.getElementById('nowPlaying').textContent = track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                document.getElementById('nowPlayingArtist').textContent = track.artist?.name || track.artistName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç';
                const playerCoverUrl = getTrackCoverUrl(track, 200);
                document.getElementById('playerCover').src = playerCoverUrl;
                document.getElementById('totalTime').textContent = formatDuration(track.duration || 0);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–µ—Ä
                document.getElementById('playerSection').classList.remove('hidden');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –∞—Ä—Ç–∏—Å—Ç–∞, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—Ä—Ç–∏—Å—Ç–∞
                if (currentArtistId && document.getElementById('artistPageTab') && !document.getElementById('artistPageTab').classList.contains('hidden')) {
                    loadArtistTracks();
                }

                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isPlaying = true;
                        updatePlayPauseButton();
                    }).catch(error => {
                        console.error('Play error:', error);
                    });
                }

                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
                incrementPlayCount(trackId);

            } catch (error) {
                console.error('Play track error:', error);
                alert(`–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ${error.message}`);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        async function updatePlaylistFromContext() {
            try {
                // –ï—Å–ª–∏ –º—ã –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                if (currentView.type === 'playlist') {
                    return; // –ü–ª–µ–π–ª–∏—Å—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ viewPlaylist
                }
                
                if (currentView.type === 'tracks' && currentView.albumId) {
                    // –¢—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞
                    const response = await fetch(`${API_BASE}/albums/${currentView.albumId}/tracks?size=50`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        playlist = data.content || [];
                    }
                } else if (currentArtistId) {
                    // –¢—Ä–µ–∫–∏ –∞—Ä—Ç–∏—Å—Ç–∞
                    const response = await fetch(`${API_BASE}/artists/${currentArtistId}/tracks?size=50`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        playlist = data.content || [];
                    }
                } else {
                    // –í—Å–µ —Ç—Ä–µ–∫–∏
                    const response = await fetch(`${API_BASE}/tracks?size=50`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        playlist = data.content || [];
                    }
                }
            } catch (error) {
                console.error('Error updating playlist:', error);
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–µ—Ä–æ–º
        function togglePlayPause() {
            const audioPlayer = document.getElementById('audioPlayer');
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
            } else {
                audioPlayer.play().then(() => {
                    isPlaying = true;
                }).catch(error => {
                    console.error('Play error:', error);
                });
            }
            updatePlayPauseButton();
        }

        function updatePlayPauseButton() {
            const btn = document.getElementById('playPauseBtn');
            btn.textContent = isPlaying ? '‚è∏' : '‚ñ∂';
        }

        function playNextTrack() {
            if (playlist.length === 0) return;
            
            let nextIndex;
            if (isShuffle) {
                nextIndex = Math.floor(Math.random() * playlist.length);
            } else {
                nextIndex = (currentTrackIndex + 1) % playlist.length;
            }
            
            if (nextIndex === currentTrackIndex && repeatMode === 'none' && !isShuffle) {
                // –î–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞
                return;
            }
            
            playTrack(playlist[nextIndex].id, playlist);
        }

        function playPreviousTrack() {
            if (playlist.length === 0) return;
            
            let prevIndex;
            if (isShuffle) {
                prevIndex = Math.floor(Math.random() * playlist.length);
            } else {
                prevIndex = currentTrackIndex - 1;
                if (prevIndex < 0) prevIndex = playlist.length - 1;
            }
            
            playTrack(playlist[prevIndex].id, playlist);
        }

        function toggleShuffle() {
            isShuffle = !isShuffle;
            const btn = document.getElementById('shuffleBtn');
            if (isShuffle) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        function toggleRepeat() {
            const btn = document.getElementById('repeatBtn');
            if (repeatMode === 'none') {
                repeatMode = 'all';
                btn.textContent = 'üîÅ';
                btn.classList.add('active');
            } else if (repeatMode === 'all') {
                repeatMode = 'one';
                btn.textContent = 'üîÇ';
                btn.classList.add('active');
            } else {
                repeatMode = 'none';
                btn.textContent = 'üîÅ';
                btn.classList.remove('active');
            }
        }

        function toggleMute() {
            const audioPlayer = document.getElementById('audioPlayer');
            const btn = document.getElementById('volumeBtn');
            if (audioPlayer.volume > 0) {
                audioPlayer.volume = 0;
                btn.textContent = 'üîá';
            } else {
                audioPlayer.volume = volume;
                btn.textContent = 'üîä';
            }
            updateVolumeDisplay();
        }

        function setVolume(event) {
            const slider = document.getElementById('volumeSlider');
            const rect = slider.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percent = Math.max(0, Math.min(1, x / rect.width));
            volume = percent;
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.volume = volume;
            updateVolumeDisplay();
            const btn = document.getElementById('volumeBtn');
            if (volume === 0) {
                btn.textContent = 'üîá';
            } else {
                btn.textContent = 'üîä';
            }
        }

        function updateVolumeDisplay() {
            const fill = document.getElementById('volumeFill');
            fill.style.width = (volume * 100) + '%';
        }

        function seekTrack(event) {
            const audioPlayer = document.getElementById('audioPlayer');
            if (!audioPlayer.duration) return;
            
            const progressBar = document.getElementById('progressBar');
            const rect = progressBar.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percent = Math.max(0, Math.min(1, x / rect.width));
            audioPlayer.currentTime = percent * audioPlayer.duration;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–µ–µ—Ä–∞
        window.addEventListener('DOMContentLoaded', function() {
            const audioPlayer = document.getElementById('audioPlayer');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            audioPlayer.addEventListener('timeupdate', function() {
                const current = audioPlayer.currentTime;
                const duration = audioPlayer.duration;
                if (duration) {
                    const percent = (current / duration) * 100;
                    document.getElementById('progressFill').style.width = percent + '%';
                    document.getElementById('progressHandle').style.left = percent + '%';
                    document.getElementById('currentTime').textContent = formatDuration(current);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç—Ä–µ–∫–∞
            audioPlayer.addEventListener('ended', function() {
                if (repeatMode === 'one') {
                    audioPlayer.currentTime = 0;
                    audioPlayer.play();
                } else if (repeatMode === 'all' || isShuffle) {
                    playNextTrack();
                } else {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫, –∏–≥—Ä–∞–µ–º –µ–≥–æ
                    if (currentTrackIndex < playlist.length - 1) {
                        playNextTrack();
                    } else {
                        isPlaying = false;
                        updatePlayPauseButton();
                    }
                }
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
            audioPlayer.addEventListener('play', function() {
                isPlaying = true;
                updatePlayPauseButton();
            });

            audioPlayer.addEventListener('pause', function() {
                isPlaying = false;
                updatePlayPauseButton();
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            audioPlayer.volume = volume;
            updateVolumeDisplay();
        });

        // –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function getImageUrl(path) {
            if (!path) {
                return '';
            }
            if (path.startsWith('http://') || path.startsWith('https://')) {
                return path;
            }
            if (path.startsWith('covers/') || path.startsWith('audio/')) {
                return `http://localhost:8080/api/v1/files/${path}`;
            }
            if (path.startsWith('/')) {
                return `http://localhost:8080${path}`;
            }
            return `http://localhost:8080/api/v1/files/covers/${path}`;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–ª–æ–∂–∫–∏ —Ç—Ä–µ–∫–∞ - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±–ª–æ–∂–∫—É –∞–ª—å–±–æ–º–∞
        function getTrackCoverUrl(track, placeholderSize = 60) {
            // –¢—Ä–µ–∫ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–ª–æ–∂–∫—É –∞–ª—å–±–æ–º–∞
            if (track.album && track.album.photoUrl) {
                return getImageUrl(track.album.photoUrl);
            }
            // –ï—Å–ª–∏ —É —Ç—Ä–µ–∫–∞ –µ—Å—Ç—å coverUrl (–∏–∑ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
            if (track.coverUrl) {
                return getImageUrl(track.coverUrl);
            }
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–ª—å–±–æ–º–∞ –∏ —É –∞–ª—å–±–æ–º–∞ –µ—Å—Ç—å –æ–±–ª–æ–∂–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
            if (currentAlbumData && currentAlbumData.photoUrl) {
                return getImageUrl(currentAlbumData.photoUrl);
            }
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞—Ä—Ç–∏—Å—Ç–∞ –∏ —É –∞—Ä—Ç–∏—Å—Ç–∞ –µ—Å—Ç—å –æ–±–ª–æ–∂–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
            if (currentArtistData && currentArtistData.photoUrl) {
                return getImageUrl(currentArtistData.photoUrl);
            }
            // –ï—Å–ª–∏ –∞–ª—å–±–æ–º–∞ –Ω–µ—Ç –∏–ª–∏ —É –∞–ª—å–±–æ–º–∞ –Ω–µ—Ç –æ–±–ª–æ–∂–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º placeholder
            return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${placeholderSize}' height='${placeholderSize}'%3E%3Crect fill='%23e0e0e0' width='${placeholderSize}' height='${placeholderSize}'/%3E%3C/svg%3E`;
        }

        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
        async function incrementPlayCount(trackId) {
            try {
                await fetch(`${API_BASE}/tracks/${trackId}/play`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function handleAuthError() {
            token = '';
            localStorage.removeItem('token');
            document.body.classList.add('auth-page');
            const authHeader = document.getElementById('authHeader');
            if (authHeader) authHeader.classList.remove('hidden');
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('toolbar').classList.add('hidden');
            document.getElementById('mainTitle').classList.remove('hidden');
            alert('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª—ã—Ö —Å–µ–∫—É–Ω–¥
            const totalSeconds = Math.floor(seconds);
            const mins = Math.floor(totalSeconds / 60);
            const secs = totalSeconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ü–æ–∏—Å–∫
        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                const query = document.getElementById('searchInput')?.value.trim() || '';
                if (query) {
                    performSearchWithQuery(query);
                }
            }
        }

        async function performSearch() {
            const query = document.getElementById('searchInput')?.value.trim() || document.getElementById('toolbarSearchInput')?.value.trim() || '';
            if (!query) return;
            performSearchWithQuery(query);
        }

        // ========== –ü–õ–ï–ô–õ–ò–°–¢–´ ==========

        let selectedTrackId = null;
        let favoritePlaylistId = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
        async function loadPlaylists() {
            const playlistsListDiv = document.getElementById('playlistsList');
            playlistsListDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/playlists/my-playlists`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const playlists = await response.json();

                // –ù–∞—Ö–æ–¥–∏–º –∏–∑–±—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                const favorite = playlists.find(p => p.isFavorite);
                if (favorite) {
                    favoritePlaylistId = favorite.id;
                }

                if (playlists.length === 0) {
                    playlistsListDiv.innerHTML = '<div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç!</div>';
                    return;
                }

                playlistsListDiv.innerHTML = playlists.map(playlist => `
                    <div class="card playlist-item" onclick="viewPlaylist(${playlist.id})">
                        <div class="playlist-actions">
                            ${!playlist.isFavorite ? `<button class="playlist-action-btn" onclick="event.stopPropagation(); deletePlaylist(${playlist.id})" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>` : ''}
                        </div>
                        <div class="card-image" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 3em;">
                            ${playlist.isFavorite ? '‚ô°' : ''}
                        </div>
                        <div class="card-title">${escapeHtml(playlist.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                        <div class="card-subtitle">${playlist.track ? playlist.track.length : 0} —Ç—Ä–µ–∫–æ–≤</div>
                    </div>
                `).join('');
            } catch (error) {
                playlistsListDiv.innerHTML = `<div class="status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
                console.error('Load playlists error:', error);
            }
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–µ–π–ª–∏—Å—Ç–∞
        async function viewPlaylist(playlistId) {
            try {
                const response = await fetch(`${API_BASE}/playlists/${playlistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–ü–ª–µ–π–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: ${response.status}`);
                }

                const playlistData = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                document.getElementById('breadcrumb').innerHTML = `
                    <span class="breadcrumb-item" onclick="goHome()">–ì–ª–∞–≤–Ω–∞—è</span>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item">${escapeHtml(playlistData.name)}</span>
                `;
                document.getElementById('breadcrumb').classList.remove('hidden');

                // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –¥—Ä—É–≥–∏–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
                document.getElementById('homeTab').classList.add('hidden');
                document.getElementById('artistPageTab').classList.add('hidden');
                document.getElementById('profileTab').classList.add('hidden');
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç—Ä–µ–∫–æ–≤
                const tracksTab = document.getElementById('tracksTab');
                if (!tracksTab) {
                    throw new Error('–í–∫–ª–∞–¥–∫–∞ —Ç—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                tracksTab.classList.remove('hidden');

                const tracksListDiv = document.getElementById('tracksList');
                if (!tracksListDiv) {
                    throw new Error('–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                const tracks = playlistData.track || [];

                if (tracks.length === 0) {
                    tracksListDiv.innerHTML = '<div class="loading">–ü–ª–µ–π–ª–∏—Å—Ç –ø—É—Å—Ç</div>';
                    playlist = [];
                    return;
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç (–∏–∑–≤–ª–µ–∫–∞–µ–º —Ç—Ä–µ–∫–∏ –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤)
                const playlistTracks = tracks.map(item => item.track).filter(t => t != null);
                playlist = playlistTracks;
                currentView = { type: 'playlist', artistId: null, albumId: null, playlistId: playlistId };
                
                tracksListDiv.innerHTML = tracks.map(item => {
                    const track = item.track;
                    const coverUrl = getTrackCoverUrl(track);
                    return `
                        <div class="track-item">
                            <img class="track-cover" src="${coverUrl}" alt="Cover" onclick="playTrack(${track.id})" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23e0e0e0\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'" style="cursor: pointer;">
                            <div class="track-info" onclick="playTrack(${track.id})" style="cursor: pointer; flex: 1;">
                                <div class="track-title">${escapeHtml(track.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>
                                <div class="track-artist">${escapeHtml(track.artist?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–∏—Å—Ç')}</div>
                            </div>
                            <div class="track-actions">
                                ${playlistData.isFavorite ? `<button class="action-button" onclick="event.stopPropagation(); removeFromFavorite(${track.id})" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">√ó</button>` : ''}
                                ${!playlistData.isFavorite ? `<button class="action-button" onclick="event.stopPropagation(); removeTrackFromPlaylist(${playlistId}, ${track.id})" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞">√ó</button>` : ''}
                                <div class="track-duration">${formatDuration(track.duration || 0)}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('View playlist error:', error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${error.message}`);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
        function showCreatePlaylistModal() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (!token) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
                return;
            }
            
            const modal = document.getElementById('createPlaylistModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
                modal.style.visibility = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
                modal.style.opacity = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            }
            const input = document.getElementById('playlistNameInput');
            if (input) {
                input.value = '';
                input.focus(); // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            }
        }

        function closeCreatePlaylistModal() {
            const modal = document.getElementById('createPlaylistModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            const input = document.getElementById('playlistNameInput');
            if (input) input.value = '';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (!document.getElementById('createPlaylistModal').classList.contains('hidden')) {
                    closeCreatePlaylistModal();
                }
                if (!document.getElementById('addToPlaylistModal').classList.contains('hidden')) {
                    closeAddToPlaylistModal();
                }
            }
        });

        async function createPlaylist() {
            const name = document.getElementById('playlistNameInput').value.trim();

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlists`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: name })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${response.status}`);
                }

                closeCreatePlaylistModal();
                loadSidebarPlaylists();
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${error.message}`);
                console.error('Create playlist error:', error);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
        async function deletePlaylist(playlistId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–µ–π–ª–∏—Å—Ç?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlists/${playlistId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                }

                loadSidebarPlaylists();
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${error.message}`);
                console.error('Delete playlist error:', error);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        async function toggleFavorite(trackId) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                if (!favoritePlaylistId) {
                    const response = await fetch(`${API_BASE}/playlists/my-favorite`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const favorite = await response.json();
                        favoritePlaylistId = favorite.id;
                    } else {
                        alert('–ò–∑–±—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç—Ä–µ–∫ —É–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º
                const playlistResponse = await fetch(`${API_BASE}/playlists/${favoritePlaylistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (playlistResponse.ok) {
                    const playlist = await playlistResponse.json();
                    const trackExists = playlist.track && playlist.track.some(item => item.track.id === trackId);

                    if (trackExists) {
                        // –£–¥–∞–ª—è–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                        await removeFromFavorite(trackId);
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        await addTrackToPlaylist(favoritePlaylistId, trackId);
                        alert('–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
                    }
                }
            } catch (error) {
                console.error('Toggle favorite error:', error);
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        async function removeFromFavorite(trackId) {
            try {
                const response = await fetch(`${API_BASE}/playlists/tracks`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playlistId: favoritePlaylistId,
                        trackId: trackId
                    })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                }

                alert('–¢—Ä–µ–∫ —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –≤–∏–¥, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –ø–ª–µ–π–ª–∏—Å—Ç
                if (currentView.type === 'playlists') {
                    loadPlaylists();
                }
            } catch (error) {
                console.error('Remove from favorite error:', error);
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ø–ª–µ–π–ª–∏—Å—Ç
        async function showAddToPlaylistModal(trackId) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (!token) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
                return;
            }
            
            if (!trackId) {
                console.error('showAddToPlaylistModal called without trackId');
                return;
            }
            
            selectedTrackId = trackId;
            const modal = document.getElementById('addToPlaylistModal');
            const addBtn = document.getElementById('addToPlaylistBtn');
            
            if (!modal) {
                console.error('Modal element not found');
                return;
            }
            
            modal.classList.remove('hidden');
            modal.style.display = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            modal.style.visibility = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            modal.style.opacity = ''; // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            if (addBtn) addBtn.disabled = true;
            
            const playlistsSelectList = document.getElementById('playlistsSelectList');
            playlistsSelectList.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</div>';

            try {
                const response = await fetch(`${API_BASE}/playlists/my-playlists`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    handleAuthError();
                    closeAddToPlaylistModal();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }

                const playlists = await response.json();

                if (playlists.length === 0) {
                    playlistsSelectList.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #7f8c8d;">
                            <p style="margin-bottom: 15px;">–ù–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç —Å–Ω–∞—á–∞–ª–∞.</p>
                            <button onclick="closeAddToPlaylistModal(); setTimeout(() => showCreatePlaylistModal(), 300);" style="background: linear-gradient(135deg, #4A90E2 0%, #5B9BD5 100%); color: white; padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600;">
                                –°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç
                            </button>
                        </div>
                    `;
                    if (addBtn) addBtn.disabled = true;
                    return;
                }

                playlistsSelectList.innerHTML = playlists.map(playlist => `
                    <div class="playlist-select-item" onclick="selectPlaylist(${playlist.id})">
                        <div>
                            <strong>${escapeHtml(playlist.name)}</strong>
                            <div style="font-size: 0.9em; color: #7f8c8d;">
                                ${playlist.isFavorite ? '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ' : `${playlist.track ? playlist.track.length : 0} —Ç—Ä–µ–∫–æ–≤`}
                            </div>
                        </div>
                        <input type="radio" name="playlistSelect" value="${playlist.id}" id="playlist_${playlist.id}">
                    </div>
                `).join('');
                
                if (addBtn) addBtn.disabled = false;

            } catch (error) {
                playlistsSelectList.innerHTML = `
                    <div class="status error" style="text-align: center; padding: 20px;">
                        <p>–û—à–∏–±–∫–∞: ${error.message}</p>
                        <button onclick="closeAddToPlaylistModal()" class="btn-secondary" style="margin-top: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
                console.error('Load playlists for modal error:', error);
                if (addBtn) addBtn.disabled = true;
            }
        }

        function selectPlaylist(playlistId) {
            document.querySelectorAll('input[name="playlistSelect"]').forEach(radio => {
                radio.checked = false;
                const item = radio.closest('.playlist-select-item');
                if (item) item.classList.remove('selected');
            });
            const radio = document.getElementById(`playlist_${playlistId}`);
            if (radio) {
                radio.checked = true;
                const item = radio.closest('.playlist-select-item');
                if (item) item.classList.add('selected');
            }
            const addBtn = document.getElementById('addToPlaylistBtn');
            if (addBtn) addBtn.disabled = false;
        }

        function closeAddToPlaylistModal() {
            const modal = document.getElementById('addToPlaylistModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            selectedTrackId = null;
            const addBtn = document.getElementById('addToPlaylistBtn');
            if (addBtn) addBtn.disabled = true;
        }

        async function addTrackToSelectedPlaylist() {
            const selectedRadio = document.querySelector('input[name="playlistSelect"]:checked');
            
            if (!selectedRadio) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç');
                return;
            }

            if (!selectedTrackId) {
                alert('–û—à–∏–±–∫–∞: —Ç—Ä–µ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω');
                closeAddToPlaylistModal();
                return;
            }

            const playlistId = parseInt(selectedRadio.value);
            await addTrackToPlaylist(playlistId, selectedTrackId);
        }

        async function addTrackToPlaylist(playlistId, trackId) {
            try {
                const response = await fetch(`${API_BASE}/playlists/tracks`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playlistId: playlistId,
                        trackId: trackId
                    })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ${response.status}`);
                }

                closeAddToPlaylistModal();
                alert('–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø–ª–µ–π–ª–∏—Å—Ç');
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞: ${error.message}`);
                console.error('Add track to playlist error:', error);
            }
        }

        async function removeTrackFromPlaylist(playlistId, trackId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlists/tracks`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playlistId: playlistId,
                        trackId: trackId
                    })
                });

                if (response.status === 401) {
                    handleAuthError();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥ –ø–ª–µ–π–ª–∏—Å—Ç–∞
                viewPlaylist(playlistId);
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞: ${error.message}`);
                console.error('Remove track from playlist error:', error);
            }
        }
    </script>
</body>
</html>
